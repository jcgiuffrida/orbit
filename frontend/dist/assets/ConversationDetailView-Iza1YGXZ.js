import{Q as I,a as B}from"./QSpinnerDots-BsIIeB5d.js";import{_ as S,d as T,c as E,J as U,e as j,f as $,w as l,M,u as R,o as i,b as e,a as c,m as u,h as s,i as m,t as r,j as v,n as x,p as h,L as w,l as b,k as p,F as H,q as J,K,s as O}from"./main-BtbfkAaC.js";import{Q as G,a as L}from"./QBreadcrumbs-D-UkWGgU.js";import{f as W,u as X,_ as Y,a as Z,Q as ee,b as te}from"./NavigationDrawer-DiYLZfbT.js";import{u as oe,g as se,a as ae,b as le}from"./conversations-iese4dpW.js";import{f as z,a as ne}from"./dateFormatting-Bb5cIjpU.js";const ie={key:0,class:"text-center q-pa-xl"},re={key:1,class:"text-center q-pa-xl"},ce={class:"text-h6 text-negative q-mt-md"},de={key:2,class:"text-center q-pa-xl"},ue={key:3,class:"conversation-detail-container"},me={class:"breadcrumb-nav q-mb-md"},ve={class:"row items-start q-gutter-md"},pe={class:"col-auto gt-sm"},_e={class:"col-12 col-sm"},fe={class:"row items-center q-gutter-sm q-mb-sm"},ge={class:"text-h5 text-weight-medium"},ye={class:"text-body1 text-grey-8 q-mb-sm"},xe={key:0},he={class:"text-body2 text-grey-6"},be={key:0},Ce={class:"col-12 col-sm-auto"},we={class:"action-buttons"},ke={class:"row q-col-gutter-lg"},qe={class:"col-12 col-md-4"},Qe=["onClick"],De={class:"col"},Ve={class:"text-body2 text-weight-medium"},Be={key:0,class:"text-caption text-grey-6"},Te={class:"col-12 col-md-8"},$e={class:"text-body1 text-grey-8 pre-line conversation-notes"},Le={class:"q-ml-sm"},ze={__name:"ConversationDetailView",setup(Ne){const k=M(),f=R(),q=X(),d=oe(),g=T(!1),_=T(!1),o=E(()=>d.selectedConversation),y=a=>!a||a.length===0?"Unknown":a.map(t=>t.name).join(", "),Q=a=>ae(a),N=a=>le(a),D=a=>se(a),C=async()=>{const a=k.params.id;if(a)try{await d.fetchConversationById(a)}catch(t){console.error("Failed to load conversation:",t)}},V=()=>{f.push({name:"conversations"})},P=()=>{o.value&&f.push({name:"conversation-edit",params:{id:o.value.id}})},F=a=>{f.push({name:"person-detail",params:{id:a.id}})},A=async()=>{if(o.value)try{const a=y(o.value.participants);await d.deleteConversation(o.value.id),_.value=!1,q.notify({type:"positive",message:`Conversation with ${a} deleted successfully`,position:"top",timeout:4e3,actions:[{icon:"close",color:"white",dense:!0}]}),f.push({name:"conversations"})}catch(a){console.error("Failed to delete conversation:",a),q.notify({type:"negative",message:"Failed to delete conversation. Please try again.",position:"top",timeout:4e3})}};return U(()=>k.params.id,(a,t)=>{a&&a!==t&&C()}),j(()=>{C()}),(a,t)=>(i(),$(W,{view:"lHh Lpr lFf"},{default:l(()=>[e(Y,{onToggleDrawer:t[0]||(t[0]=n=>g.value=!g.value)}),e(Z,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=n=>g.value=n)},null,8,["modelValue"]),e(ee,null,{default:l(()=>[e(te,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:l(()=>[u(d).isLoading?(i(),c("div",ie,[e(I,{size:"50px",color:"primary"}),t[5]||(t[5]=s("div",{class:"q-mt-md"},"Loading conversation details...",-1))])):u(d).hasError?(i(),c("div",re,[e(m,{name:"error_outline",size:"80px",color:"negative"}),s("div",ce,r(u(d).error),1),e(v,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:C})])):o.value?(i(),c("div",ue,[s("div",me,[e(G,{class:"text-grey-6"},{default:l(()=>[e(L,{icon:"chat",label:"Conversations",onClick:V,class:"cursor-pointer"}),e(L,{label:`${y(o.value.participants)} - ${u(z)(o.value.date)}`},null,8,["label"])]),_:1})]),e(x,{class:"header-card q-mb-lg",flat:""},{default:l(()=>[e(h,{class:"q-pa-lg"},{default:l(()=>[s("div",ve,[s("div",pe,[e(w,{size:"64px",color:D(o.value.type),"text-color":"white"},{default:l(()=>[e(m,{name:Q(o.value.type),size:"32px"},null,8,["name"])]),_:1},8,["color"])]),s("div",_e,[s("div",fe,[s("div",ge,r(y(o.value.participants)),1),e(B,{color:D(o.value.type),"text-color":"white",icon:Q(o.value.type)},{default:l(()=>[p(r(N(o.value.type)),1)]),_:1},8,["color","icon"]),o.value.private?(i(),$(B,{key:0,color:"orange","text-color":"white",icon:"lock"},{default:l(()=>[...t[7]||(t[7]=[p(" Private to you ",-1)])]),_:1})):b("",!0)]),s("div",ye,[p(r(u(z)(o.value.date))+" ",1),o.value.location?(i(),c("span",xe," â€¢ "+r(o.value.location),1)):b("",!0)]),s("div",he,[e(m,{name:"schedule",size:"16px",class:"q-mr-xs"}),p(" Added "+r(u(ne)(o.value.created_at))+" ",1),o.value.created_by_username?(i(),c("span",be," by "+r(o.value.created_by_username),1)):b("",!0)])]),s("div",Ce,[s("div",we,[e(v,{outline:"",color:"primary",icon:"edit",label:"Edit",class:"q-mr-sm",onClick:P}),e(v,{outline:"",color:"negative",icon:"delete",label:"Delete",onClick:t[2]||(t[2]=n=>_.value=!0)})])])])]),_:1})]),_:1}),s("div",ke,[s("div",qe,[e(x,{class:"content-card",flat:"",bordered:""},{default:l(()=>[e(h,{class:"q-pa-lg"},{default:l(()=>[t[8]||(t[8]=s("div",{class:"text-h6 q-mb-md text-weight-medium"},"Participants",-1)),(i(!0),c(H,null,J(o.value.participants,n=>(i(),c("div",{key:n.id,class:"participant-item"},[s("div",{class:"row items-center q-gutter-sm cursor-pointer",onClick:Pe=>F(n)},[e(w,{size:"32px",color:"grey-4","text-color":"grey-8"},{default:l(()=>[e(m,{name:"person"})]),_:1}),s("div",De,[s("div",Ve,r(n.name),1),n.name_ext?(i(),c("div",Be,r(n.name_ext),1)):b("",!0)]),e(m,{name:"chevron_right",color:"grey-5"})],8,Qe)]))),128))]),_:1})]),_:1})]),s("div",Te,[e(x,{class:"content-card",flat:"",bordered:""},{default:l(()=>[e(h,{class:"q-pa-lg"},{default:l(()=>[t[9]||(t[9]=s("div",{class:"text-h6 q-mb-md text-weight-medium"},"Notes",-1)),s("div",$e,r(o.value.notes),1)]),_:1})]),_:1})])])])):(i(),c("div",de,[e(m,{name:"chat_bubble_outline",size:"80px",color:"grey-5"}),t[6]||(t[6]=s("div",{class:"text-h6 text-grey-7 q-mt-md"}," Conversation not found ",-1)),e(v,{color:"primary",label:"Back to Conversations",class:"q-mt-md",onClick:V})])),e(K,{modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=n=>_.value=n)},{default:l(()=>[e(x,null,{default:l(()=>[e(h,{class:"row items-center"},{default:l(()=>[e(w,{icon:"warning",color:"negative","text-color":"white"}),s("span",Le,[t[10]||(t[10]=p(" Are you sure you want to delete this conversation with ",-1)),s("strong",null,r(o.value?y(o.value.participants):""),1),t[11]||(t[11]=p("? This action cannot be undone. ",-1))])]),_:1}),e(O,{align:"between"},{default:l(()=>[e(v,{flat:"",label:"Cancel",color:"grey-7",onClick:t[3]||(t[3]=n=>_.value=!1)}),e(v,{flat:"",label:"Delete",color:"negative",onClick:A})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},je=S(ze,[["__scopeId","data-v-6889cd9f"]]);export{je as default};
