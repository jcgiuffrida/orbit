import{Q as K}from"./QSpinnerDots-DKX6m9Q8.js";import{_ as X,d as m,c as B,M as Y,I as Z,J as ee,e as te,f as v,w as l,D as ae,o as d,b as t,a as A,h as r,t as c,i as k,j as S,l as _,m as T,n as D,P as E,R as U,k as C,E as N,u as oe,S as $}from"./main-BNYyCrAV.js";import{Q as le,a as I}from"./QBreadcrumbs-C5l2t67P.js";import{Q as q}from"./QItemLabel-Co7gJjbr.js";import{f as se,u as ne,_ as re,a as ie,Q as ue,b as de,d as O,e as f}from"./NavigationDrawer-CoZBpgI1.js";import{Q as R}from"./QSelect-D7AnBUJS.js";import{Q as pe}from"./QForm-09iU-u3O.js";import{u as me,c as ce}from"./contactAttempts-DvSW2dkB.js";import{u as ve}from"./people-DXZZurFb.js";import"./position-engine--pu8bc_Q.js";const fe={key:0,class:"text-center q-pa-xl"},ye={class:"q-mt-md"},ge={key:1,class:"text-center q-pa-xl"},be={class:"text-h6 text-negative q-mt-md"},_e={key:2},Ce={class:"breadcrumb-nav q-mb-md"},qe={class:"row justify-center"},Pe={class:"col-12 col-md-8 col-lg-6"},Ve={class:"row q-gutter-sm justify-end q-mt-lg"},we={__name:"ContactAttemptCreateView",setup(Qe){const p=Y(),i=ae(),y=ne(),g=me(),P=ve(),b=m(!1),V=m(!1),w=m(!1),Q=m(!1),x=m(null),n=m(null),u=B(()=>p.params.id&&p.params.id!=="new"),e=Z({person:"",date:new Date().toISOString().split("T")[0],type:"",notes:"",ledToConversation:!1,private:!1}),j=()=>{e.person="",e.date=new Date().toISOString().split("T")[0],e.type="",e.notes="",e.ledToConversation=!1,e.private=!1},z=B(()=>P.getPeopleList),L=s=>{V.value=s,s&&(Q.value=!1,x.value=null)},M=s=>{Q.value=!0,x.value=s,V.value=!1},F=async()=>{if(P.getPeopleList.length===0)try{await P.fetchPeople()}catch(s){console.error("Failed to load people:",s)}},h=async()=>{L(!0);try{if(await F(),p.query.person&&(e.person=p.query.person),u.value){const s=p.params.id;await g.fetchContactAttemptById(s),n.value=g.selectedContactAttempt,n.value&&(e.person=n.value.person,e.date=n.value.date,e.type=n.value.type,e.notes=n.value.notes||"",e.ledToConversation=!!n.value.led_to_conversation,e.private=n.value.private||!1)}}catch(s){console.error("Failed to load data:",s),M("Failed to load data")}finally{L(!1)}},W=async()=>{w.value=!0;try{const s={person:e.person,date:e.date,type:e.type,notes:e.notes||"",led_to_conversation:e.ledToConversation,private:e.private};if(u.value){const o=await g.updateContactAttempt(n.value.id,s);y.notify({type:"positive",message:"Ping updated successfully",position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),i.push({name:"pings"})}else{const o=await g.createContactAttempt(s);y.notify({type:"positive",message:"Ping added successfully",position:"top",timeout:6e3,actions:[{icon:"add",color:"white",dense:!0,label:"Add Another",handler:()=>{j(),i.push({name:"ping-create"})}},{icon:"close",color:"white",dense:!0}]}),e.ledToConversation?y.dialog({title:"Create Conversation",message:"Would you like to record a conversation from this ping?",cancel:!0,persistent:!1}).onOk(()=>{i.push({name:"conversation-create",query:{participants:e.person,from_attempt:o.id,type:e.type==="call"?"phone":e.type,date:e.date}})}).onCancel(()=>{i.push({name:"pings"})}):i.push({name:"pings"})}}catch(s){console.error("Failed to save contact attempt:",s),y.notify({type:"negative",message:`Failed to ${u.value?"update":"create"} ping. Please try again.`,position:"top",timeout:4e3})}finally{w.value=!1}},H=()=>{i.push({name:"pings"})},J=()=>{i.push({name:"pings"})},G=()=>{u.value&&n.value&&i.push({name:"person-detail",params:{id:n.value.person}})};return ee(()=>p.params.id,(s,o)=>{s&&s!==o&&h()}),te(()=>{h()}),(s,o)=>(d(),v(se,{view:"lHh Lpr lFf"},{default:l(()=>[t(re,{onToggleDrawer:o[0]||(o[0]=a=>b.value=!b.value)}),t(ie,{modelValue:b.value,"onUpdate:modelValue":o[1]||(o[1]=a=>b.value=a)},null,8,["modelValue"]),t(ue,null,{default:l(()=>[t(de,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:l(()=>[V.value?(d(),A("div",fe,[t(K,{size:"50px",color:"primary"}),r("div",ye,c(u.value?"Loading ping details...":"Loading..."),1)])):Q.value?(d(),A("div",ge,[t(k,{name:"error_outline",size:"80px",color:"negative"}),r("div",be,c(x.value),1),t(S,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:h})])):(d(),A("div",_e,[r("div",Ce,[t(le,{class:"text-grey-6"},{default:l(()=>[t(I,{icon:"contact_phone",label:"Pings",onClick:J,class:"cursor-pointer"}),u.value&&n.value?(d(),v(I,{key:0,label:`${n.value.person_name||"Ping"}`,onClick:G,class:"cursor-pointer"},null,8,["label"])):_("",!0),t(I,{label:u.value?"Edit":"Add Ping"},null,8,["label"])]),_:1})]),r("div",qe,[r("div",Pe,[t(pe,{onSubmit:W,class:"q-gutter-md",autocomplete:"off"},{default:l(()=>[t(T,null,{default:l(()=>[t(D,null,{default:l(()=>[o[8]||(o[8]=r("div",{class:"text-h6 q-mb-md"},"Ping Details",-1)),t(R,{modelValue:e.person,"onUpdate:modelValue":o[2]||(o[2]=a=>e.person=a),options:z.value,label:"Person *",filled:"",required:"","option-value":"id","option-label":"name","emit-value":"","map-options":"",autocomplete:"off",class:"q-mb-md",rules:[a=>!!a||"Person is required"],onPopupShow:F},{option:l(a=>[t(O,E(U(a.itemProps)),{default:l(()=>[t(f,null,{default:l(()=>[t(q,null,{default:l(()=>[C(c(a.opt.name),1)]),_:2},1024),a.opt.name_ext?(d(),v(q,{key:0,caption:""},{default:l(()=>[C(c(a.opt.name_ext),1)]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"]),t(N,{modelValue:e.date,"onUpdate:modelValue":o[3]||(o[3]=a=>e.date=a),label:"Date *",type:"date",filled:"",required:"",autocomplete:"off",class:"q-mb-md",rules:[a=>!!a||"Date is required"]},null,8,["modelValue","rules"]),t(R,{modelValue:e.type,"onUpdate:modelValue":o[4]||(o[4]=a=>e.type=a),options:oe(ce),label:"Contact Type *",filled:"",required:"","option-value":"value","option-label":"label","emit-value":"","map-options":"",autocomplete:"off",class:"q-mb-md",rules:[a=>!!a||"Contact type is required"]},{"selected-item":l(a=>[a.opt.icon?(d(),v(f,{key:0,avatar:""},{default:l(()=>[t(k,{name:a.opt.icon},null,8,["name"])]),_:2},1024)):_("",!0),t(f,null,{default:l(()=>[t(q,null,{default:l(()=>[C(c(a.opt.label),1)]),_:2},1024)]),_:2},1024)]),option:l(a=>[t(O,E(U(a.itemProps)),{default:l(()=>[a.opt.icon?(d(),v(f,{key:0,avatar:""},{default:l(()=>[t(k,{name:a.opt.icon},null,8,["name"])]),_:2},1024)):_("",!0),t(f,null,{default:l(()=>[t(q,null,{default:l(()=>[C(c(a.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),_:1})]),_:1}),t(T,null,{default:l(()=>[t(D,null,{default:l(()=>[o[9]||(o[9]=r("div",{class:"text-h6 q-mb-md"},"Notes",-1)),t(N,{modelValue:e.notes,"onUpdate:modelValue":o[5]||(o[5]=a=>e.notes=a),label:"Notes",type:"textarea",rows:"4",filled:"",autocomplete:"off",hint:"What was the purpose? Any response or outcome?",class:"q-mb-md"},null,8,["modelValue"])]),_:1})]),_:1}),t(T,null,{default:l(()=>[t(D,null,{default:l(()=>[o[10]||(o[10]=r("div",{class:"text-h6 q-mb-md"},"Follow-up & Privacy",-1)),t($,{modelValue:e.ledToConversation,"onUpdate:modelValue":o[6]||(o[6]=a=>e.ledToConversation=a),label:"This led to a conversation",color:"positive",class:"q-mb-md"},null,8,["modelValue"]),o[11]||(o[11]=r("br",null,null,-1)),t($,{modelValue:e.private,"onUpdate:modelValue":o[7]||(o[7]=a=>e.private=a),label:"Private ping",color:"orange"},null,8,["modelValue"]),o[12]||(o[12]=r("div",{class:"text-caption text-grey-6 q-ml-lg"}," Private pings are only visible to you ",-1))]),_:1})]),_:1}),r("div",Ve,[t(S,{flat:"",label:"Cancel",color:"grey-7",onClick:H}),t(S,{type:"submit",label:u.value?"Save Changes":"Add Ping",color:"primary",loading:w.value},null,8,["label","loading"])])]),_:1})])])]))]),_:1})]),_:1})]),_:1}))}},Be=X(we,[["__scopeId","data-v-e1bcac9b"]]);export{Be as default};
