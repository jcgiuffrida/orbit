import{_ as R,d as C,c as P,e as U,f as k,w as s,u as I,o as l,b as a,h as c,a as r,l as m,j as w,E as j,i as y,m as p,t as d,F as Y,q as Z,n as G,p as H,k as f,v as J,s as K,G as L}from"./main-C8eLUZHf.js";import{Q as N}from"./QSelect-7DMXMTRB.js";import{Q as W}from"./QSpinnerDots-rM26rU5M.js";import{Q}from"./QTooltip-CwptUy-z.js";import{f as X,u as ee,_ as te,a as oe,Q as ae,b as le}from"./NavigationDrawer-CgCiqeaQ.js";import{u as ne}from"./people-Dlie6Wa_.js";import"./QItemLabel-DOCnpRxJ.js";import"./position-engine-CYTD2jtF.js";const se={class:"row items-center q-mb-lg"},ie={class:"row q-col-gutter-md q-mb-lg"},re={class:"col-12 col-md-6"},ce={class:"col-12 col-md-3"},de={class:"col-12 col-md-3"},ue={key:0,class:"text-center q-pa-lg"},me={key:1,class:"text-center q-pa-xl"},pe={class:"text-h6 text-grey-7 q-mt-md"},fe={key:2,class:"row q-col-gutter-md"},ye={class:"text-h6 q-mb-xs"},ve={key:0,class:"text-caption text-grey-7 q-mb-sm"},_e={key:1,class:"text-body2 text-grey-8 q-mb-sm"},ge={key:2,class:"text-body2 text-grey-8 q-mb-sm"},we={key:4,class:"text-caption text-grey-6"},xe={key:3,class:"row items-center justify-center q-mt-lg"},he={class:"text-body2 text-grey-6"},Ce={key:0},ke={__name:"PeopleView",setup(be){const b=I(),_=ee(),i=ne(),x=C(!1),v=C(""),q=C("name"),h=C(""),S=[{label:"Name (A-Z)",value:"name"},{label:"Name (Z-A)",value:"-name"},{label:"Recently Contacted",value:"-last_contacted"},{label:"Least Recently Contacted",value:"last_contacted"}],z=P(()=>{const o=new Set;return i.people.forEach(e=>{e.location&&e.location.trim()&&o.add(e.location.trim())}),Array.from(o).sort().map(e=>({label:e,value:e}))}),D=P(()=>{let o=[...i.getPeopleList];if(v.value){const e=v.value.toLowerCase().trim();o=o.filter(t=>t.name.toLowerCase().includes(e)||t.name_ext&&t.name_ext.toLowerCase().includes(e)||t.location&&t.location.toLowerCase().includes(e)||t.company&&t.company.toLowerCase().includes(e))}return h.value&&(o=o.filter(e=>e.location&&e.location.trim()===h.value)),o.sort((e,t)=>{switch(q.value){case"name":return e.name.localeCompare(t.name);case"-name":return t.name.localeCompare(e.name);case"-last_contacted":return!e.last_contacted&&!t.last_contacted?0:e.last_contacted?t.last_contacted?new Date(t.last_contacted)-new Date(e.last_contacted):-1:1;case"last_contacted":return!e.last_contacted&&!t.last_contacted?0:e.last_contacted?t.last_contacted?new Date(e.last_contacted)-new Date(t.last_contacted):-1:1;default:return 0}}),o}),V=async()=>{try{const o=i.peopleCount===1;await i.fetchPeople(o)}catch(o){console.error("Error loading people:",o)}},F=o=>{if(!o)return"Never";const e=new Date(o),u=new Date-e,n=Math.floor(u/(1e3*60*60*24));if(n===0)return"Today";if(n===1)return"Yesterday";if(n<7)return n===1?"1 day ago":`${n} days ago`;if(n<30){const g=Math.floor(n/7);return g===1?"1 week ago":`${g} weeks ago`}if(n<365){const g=Math.floor(n/30);return g===1?"1 month ago":`${g} months ago`}return e.toLocaleDateString()},T=async o=>{if(!o.email){_.notify({type:"warning",message:`No email address available for ${o.name}`,position:"top",timeout:3e3});return}try{await navigator.clipboard.writeText(o.email),_.notify({type:"positive",message:`Email copied: ${o.email}`,position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]})}catch(e){console.error("Failed to copy email:",e),_.notify({type:"negative",message:"Failed to copy email address",position:"top",timeout:3e3})}},M=o=>{b.push({name:"person-detail",params:{id:o.id}})},A=o=>{o.phone?(window.open(`sms:${o.phone}`),_.notify({type:"info",message:`Opening SMS to ${o.name}`,position:"top",timeout:2e3})):_.notify({type:"warning",message:`No phone number available for ${o.name}`,position:"top",timeout:3e3})},$=()=>{b.push({name:"person-edit",params:{id:"new"}})},E=o=>{b.push({name:"conversation-create",query:{participants:o.id}})},B=o=>{if(!o)return"grey-6";const e=new Date(o),u=new Date-e,n=Math.floor(u/(1e3*60*60*24));return n<=60?"positive":n<=180?"grey-7":"negative"},O=o=>{if(!o)return"text-grey-6";const e=new Date(o),u=new Date-e,n=Math.floor(u/(1e3*60*60*24));return n<=60?"text-positive":n<=180?"text-grey-8":"text-negative"};return U(()=>{V()}),(o,e)=>(l(),k(X,{view:"lHh Lpr lFf"},{default:s(()=>[a(te,{onToggleDrawer:e[0]||(e[0]=t=>x.value=!x.value)}),a(oe,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t)},null,8,["modelValue"]),a(ae,null,{default:s(()=>[a(le,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[c("div",se,[e[5]||(e[5]=c("div",{class:"text-h4 col"},"People",-1)),a(w,{color:"primary",icon:"add",label:"Add Person",onClick:$})]),c("div",ie,[c("div",re,[a(j,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),filled:"",placeholder:"Search people...",clearable:""},{prepend:s(()=>[a(y,{name:"search"})]),_:1},8,["modelValue"])]),c("div",ce,[a(N,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=t=>h.value=t),filled:"",options:z.value,label:"Filter by Location",clearable:"","emit-value":"","map-options":""},{prepend:s(()=>[a(y,{name:"place"})]),_:1},8,["modelValue","options"])]),c("div",de,[a(N,{modelValue:q.value,"onUpdate:modelValue":[e[4]||(e[4]=t=>q.value=t),V],filled:"",options:S,label:"Sort by","emit-value":"","map-options":""},null,8,["modelValue"])])]),p(i).isLoading?(l(),r("div",ue,[a(W,{size:"50px",color:"primary"}),e[6]||(e[6]=c("div",{class:"q-mt-md"},"Loading people...",-1))])):D.value.length===0?(l(),r("div",me,[a(y,{name:"people_outline",size:"80px",color:"grey-5"}),c("div",pe,d(v.value?"No people found matching your search":"No people added yet"),1),v.value?m("",!0):(l(),k(w,{key:0,color:"primary",label:"Add Your First Person",class:"q-mt-md",onClick:$}))])):(l(),r("div",fe,[(l(!0),r(Y,null,Z(D.value,t=>(l(),r("div",{key:t.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[a(G,{class:"person-card full-height cursor-pointer flex column",onClick:u=>M(t)},{default:s(()=>[a(H,{class:"flex-grow-1"},{default:s(()=>[c("div",ye,d(t.name),1),t.name_ext?(l(),r("div",ve,d(t.name_ext),1)):m("",!0),t.location?(l(),r("div",_e,[a(y,{name:"place",size:"16px",class:"q-mr-xs"}),f(" "+d(t.location),1)])):m("",!0),t.company?(l(),r("div",ge,[a(y,{name:"business",size:"16px",class:"q-mr-xs"}),f(" "+d(t.company),1)])):m("",!0),t.last_contacted?(l(),r("div",{key:3,class:J(["text-caption",O(t.last_contacted)])},[a(y,{name:"schedule",size:"14px",class:"q-mr-xs",color:B(t.last_contacted)},null,8,["color"]),f(" Last contact: "+d(F(t.last_contacted)),1)],2)):(l(),r("div",we,[a(y,{name:"schedule",size:"14px",class:"q-mr-xs"}),e[7]||(e[7]=f(" No contact recorded ",-1))]))]),_:2},1024),a(K,{align:"right"},{default:s(()=>[t.email?(l(),k(w,{key:0,flat:"",round:"",size:"md",icon:"email",color:"info",onClick:L(u=>T(t),["stop"])},{default:s(()=>[a(Q,null,{default:s(()=>[...e[8]||(e[8]=[f("Copy Email Address",-1)])]),_:1})]),_:2},1032,["onClick"])):m("",!0),t.phone?(l(),k(w,{key:1,flat:"",round:"",size:"md",icon:"sms",color:"info",onClick:L(u=>A(t),["stop"])},{default:s(()=>[a(Q,null,{default:s(()=>[...e[9]||(e[9]=[f("Send Text Message",-1)])]),_:1})]),_:2},1032,["onClick"])):m("",!0),a(w,{flat:"",round:"",size:"md",icon:"add",color:"primary",onClick:L(u=>E(t),["stop"])},{default:s(()=>[a(Q,null,{default:s(()=>[...e[10]||(e[10]=[f("Log Conversation",-1)])]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])),p(i).people.length>0?(l(),r("div",xe,[c("div",he,[f(" Showing "+d(D.value.length)+" of "+d(p(i).people.length)+" people ",1),p(i).pagination.count&&p(i).pagination.count!==p(i).people.length?(l(),r("span",Ce," ("+d(p(i).people.length)+" of "+d(p(i).pagination.count)+" total loaded) ",1)):m("",!0)])])):m("",!0)]),_:1})]),_:1})]),_:1}))}},Se=R(ke,[["__scopeId","data-v-03d6c541"]]);export{Se as default};
