import{_ as G,d as w,c as H,e as Y,f,w as s,C as Z,o as n,b as o,h as l,a as r,j as k,D as J,i,u as y,t as m,l as b,F as K,p as W,L as X,m as ee,n as te,k as c,G as oe,N as A,O as ae}from"./main-BUattiJr.js";import{Q as F,a as se}from"./QSelect-D_7hzanl.js";import{Q as le}from"./QSpinnerDots-C2No3ue-.js";import{Q as $}from"./QChip-bPL42vie.js";import{Q as ne}from"./QTooltip-CoLS9g1J.js";import{f as re,u as ie,_ as ce,a as de,Q as me,b as ue,c as pe,d as Q,e as _}from"./NavigationDrawer-CuUZiH8A.js";import{C as q}from"./ClosePopup-Ddft_vXm.js";import{u as ve,g as V,c as fe,a as _e,b as ye}from"./contactAttempts-NlcEZ8oZ.js";import{f as Ce,a as ge}from"./dateFormatting-FSBT3tMj.js";import"./QItemLabel-C8FJA7k9.js";const we={class:"row items-center q-mb-lg"},ke={class:"row q-col-gutter-md q-mb-lg"},be={class:"col-12 col-md-6"},he={class:"col-12 col-md-3"},xe={class:"col-12 col-md-3"},Ae={key:0,class:"text-center q-pa-lg"},Qe={key:1,class:"text-center q-pa-xl"},qe={class:"text-h6 text-negative q-mt-md"},Ve={key:2,class:"text-center q-pa-xl"},Te={class:"text-h6 text-grey-7 q-mt-md"},De={key:3,class:"timeline-container"},Le={class:"timeline-marker"},Se={class:"row items-start justify-between"},ze={class:"col"},Fe={class:"row items-center q-gutter-sm q-mb-sm"},$e={class:"text-h6 text-weight-medium"},Ne={class:"text-body2 text-grey-8 q-mb-sm"},Ie={key:0,class:"text-body2 text-grey-7"},Pe={key:1,class:"text-caption text-positive q-mt-sm"},Be={class:"col-auto"},Oe={__name:"ContactAttemptsView",setup(Me){const C=Z(),h=ie(),u=ve(),g=w(!1),p=w(""),v=w(""),x=w("-date"),N=[...fe,{label:"All Types",value:""}],I=[{label:"Most Recent",value:"-date"},{label:"Oldest First",value:"date"},{label:"Type",value:"type"},{label:"Person (A-Z)",value:"person_name"}],T=H(()=>{let a=[...u.getContactAttemptsList];if(p.value){const e=p.value.toLowerCase().trim();a=a.filter(t=>{const d=(t.person_name||"").toLowerCase(),R=(t.notes||"").toLowerCase();return d.includes(e)||R.includes(e)})}return v.value&&(a=a.filter(e=>e.type===v.value)),a.sort((e,t)=>{switch(x.value){case"date":return new Date(e.date)-new Date(t.date);case"-date":return new Date(t.date)-new Date(e.date);case"type":return V(e.type).localeCompare(V(t.type));case"person_name":return(e.person_name||"").localeCompare(t.person_name||"");default:return 0}}),a}),D=a=>ye(a),P=a=>V(a),L=a=>_e(a),B=(a,e)=>!a||a.length<=e?a:a.substring(0,e).trim()+"...",S=async()=>{try{await u.fetchContactAttempts()}catch(a){console.error("Error loading contact attempts:",a)}},O=a=>{C.push({name:"contact-attempt-detail",params:{id:a.id}})},z=()=>{C.push({name:"contact-attempt-create"})},M=a=>{C.push({name:"contact-attempt-edit",params:{id:a.id}})},U=a=>{C.push({name:"conversation-create",query:{participants:a.person,from_attempt:a.id}})},E=async a=>{h.dialog({title:"Delete Contact Attempt",message:`Are you sure you want to delete this contact attempt with ${a.person_name}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await u.deleteContactAttempt(a.id),h.notify({type:"positive",message:"Contact attempt deleted successfully",position:"top",timeout:3e3})}catch(e){console.error("Failed to delete contact attempt:",e),h.notify({type:"negative",message:"Failed to delete contact attempt. Please try again.",position:"top",timeout:4e3})}})},j=(a,e)=>{};return Y(()=>{S()}),(a,e)=>(n(),f(re,{view:"lHh Lpr lFf"},{default:s(()=>[o(ce,{onToggleDrawer:e[0]||(e[0]=t=>g.value=!g.value)}),o(de,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t)},null,8,["modelValue"]),o(me,null,{default:s(()=>[o(ue,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[l("div",we,[e[5]||(e[5]=l("div",{class:"text-h4 col"},"Contact Attempts",-1)),o(k,{color:"primary",icon:"add",label:"Add Contact Attempt",onClick:z})]),l("div",ke,[l("div",be,[o(J,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),filled:"",placeholder:"Search contact attempts...",clearable:""},{prepend:s(()=>[o(i,{name:"search"})]),_:1},8,["modelValue"])]),l("div",he,[o(F,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),filled:"",options:N,label:"Filter by type","emit-value":"","map-options":"",clearable:""},null,8,["modelValue"])]),l("div",xe,[o(F,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=t=>x.value=t),filled:"",options:I,label:"Sort by","emit-value":"","map-options":""},null,8,["modelValue"])])]),y(u).isLoading?(n(),r("div",Ae,[o(le,{size:"50px",color:"primary"}),e[6]||(e[6]=l("div",{class:"q-mt-md"},"Loading contact attempts...",-1))])):y(u).hasError?(n(),r("div",Qe,[o(i,{name:"error_outline",size:"80px",color:"negative"}),l("div",qe,m(y(u).error),1),o(k,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:S})])):T.value.length===0?(n(),r("div",Ve,[o(i,{name:"contact_phone",size:"80px",color:"grey-5"}),l("div",Te,m(p.value||v.value?"No contact attempts found matching your criteria":"No contact attempts recorded yet"),1),!p.value&&!v.value?(n(),f(k,{key:0,color:"primary",label:"Add Your First Contact Attempt",class:"q-mt-md",onClick:z})):b("",!0)])):(n(),r("div",De,[(n(!0),r(K,null,W(T.value,t=>(n(),r("div",{key:t.id,class:"timeline-item q-mb-md"},[l("div",Le,[o(X,{size:"40px",color:L(t.type),"text-color":"white"},{default:s(()=>[o(i,{name:D(t.type),size:"20px"},null,8,["name"])]),_:2},1032,["color"])]),o(ee,{class:"timeline-card cursor-pointer",onClick:d=>O(t)},{default:s(()=>[o(te,null,{default:s(()=>[l("div",Se,[l("div",ze,[l("div",Fe,[l("div",$e,m(t.person_name||"Unknown Person"),1),o($,{size:"sm",color:L(t.type),"text-color":"white",icon:D(t.type)},{default:s(()=>[c(m(P(t.type)),1)]),_:2},1032,["color","icon"]),t.private?(n(),f($,{key:0,size:"sm",color:"orange","text-color":"white",icon:"lock"},{default:s(()=>[...e[7]||(e[7]=[c(" Private ",-1)])]),_:1})):b("",!0)]),l("div",Ne,[c(m(y(Ce)(t.date))+" ",1),o(ne,null,{default:s(()=>[c(m(y(ge)(t.date)),1)]),_:2},1024)]),t.notes?(n(),r("div",Ie,m(B(t.notes,150)),1)):b("",!0),t.led_to_conversation?(n(),r("div",Pe,[o(i,{name:"arrow_forward",size:"14px",class:"q-mr-xs"}),e[8]||(e[8]=c(" Led to conversation ",-1))])):b("",!0)]),l("div",Be,[o(k,{flat:"",round:"",size:"sm",icon:"more_vert",onClick:oe(d=>j(d,t),["stop"])},{default:s(()=>[o(se,null,{default:s(()=>[o(pe,{style:{"min-width":"100px"}},{default:s(()=>[A((n(),f(Q,{clickable:"",onClick:d=>M(t)},{default:s(()=>[o(_,{avatar:""},{default:s(()=>[o(i,{name:"edit"})]),_:1}),o(_,null,{default:s(()=>[...e[9]||(e[9]=[c("Edit",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]]),A((n(),f(Q,{clickable:"",onClick:d=>U(t)},{default:s(()=>[o(_,{avatar:""},{default:s(()=>[o(i,{name:"chat_bubble"})]),_:1}),o(_,null,{default:s(()=>[...e[10]||(e[10]=[c("Add Conversation",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]]),o(ae),A((n(),f(Q,{clickable:"",onClick:d=>E(t)},{default:s(()=>[o(_,{avatar:""},{default:s(()=>[o(i,{name:"delete",color:"negative"})]),_:1}),o(_,{class:"text-negative"},{default:s(()=>[...e[11]||(e[11]=[c("Delete",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]))]),_:1})]),_:1})]),_:1}))}},We=G(Oe,[["__scopeId","data-v-7fde2aaa"]]);export{We as default};
