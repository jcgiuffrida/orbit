import{Q as W}from"./QSpinnerDots-COME6D_6.js";import{_ as H,d as c,c as A,M as J,I as K,J as G,e as X,f as y,w as l,C as Y,o as d,b as a,a as h,h as i,t as m,i as w,j as S,l as k,m as P,n as D,k as I,D as L,u as Z,P as ee,R as ae,S as te}from"./main-BSNfDbTQ.js";import{Q as oe,a as T}from"./QBreadcrumbs-CdOISPkB.js";import{Q as le}from"./QChip-CiA8MApy.js";import{Q as E}from"./QSelect-wSek9BIm.js";import{f as se,u as ne,_ as ie,a as re,Q as ue,b as de,d as pe,e as b}from"./NavigationDrawer-Cd3a0AvU.js";import{Q as U}from"./QItemLabel-CDBU9do_.js";import{Q as ce}from"./QForm-DcMUIj_2.js";import{u as me,c as ve}from"./conversations-I7sj76Kg.js";import{u as fe}from"./people-BTbzMQ5w.js";const ye={key:0,class:"text-center q-pa-xl"},be={class:"q-mt-md"},ge={key:1,class:"text-center q-pa-xl"},Ce={class:"text-h6 text-negative q-mt-md"},_e={key:2},qe={class:"breadcrumb-nav q-mb-md"},xe={class:"row justify-center"},Ve={class:"col-12 col-md-10 col-lg-8"},Qe={class:"row q-gutter-sm justify-end q-mt-lg"},he={__name:"ConversationCreateView",setup(we){const p=J(),u=Y(),g=ne(),v=me(),C=fe(),f=c(!1),_=c(!1),q=c(!1),x=c(!1),V=c(null),n=c(null),r=A(()=>p.params.id&&p.params.id!=="new"),o=K({participants:[],date:new Date().toISOString().split("T")[0],type:"",location:"",notes:"",private:!1}),N=()=>{o.participants=[],o.date=new Date().toISOString().split("T")[0],o.type="",o.location="",o.notes="",o.private=!1},R=A(()=>C.getPeopleList),B=s=>{_.value=s,s&&(x.value=!1,V.value=null)},$=s=>{x.value=!0,V.value=s,_.value=!1},F=async()=>{if(C.getPeopleList.length===0)try{await C.fetchPeople()}catch(s){console.error("Failed to load people:",s)}},Q=async()=>{B(!0);try{if(await F(),r.value){const s=p.params.id;await v.fetchConversationById(s),n.value=v.selectedConversation,n.value&&(o.participants=n.value.participants.map(t=>t.id),o.date=n.value.date,o.type=n.value.type,o.location=n.value.location||"",o.notes=n.value.notes||"",o.private=n.value.private||!1)}else p.query.participants&&(o.participants=p.query.participants.split(","))}catch(s){console.error("Failed to load data:",s),$("Failed to load data")}finally{B(!1)}},j=async()=>{q.value=!0;try{const s={participant_ids:o.participants,date:o.date,type:o.type,location:o.location||"",notes:o.notes,private:o.private};if(r.value){const t=await v.updateConversation(n.value.id,s);g.notify({type:"positive",message:"Conversation updated successfully",position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),u.push({name:"conversation-detail",params:{id:t.id}})}else{const t=await v.createConversation(s);g.notify({type:"positive",message:"Conversation added successfully",position:"top",timeout:6e3,actions:[{icon:"add",color:"white",dense:!0,label:"Add Another",handler:()=>{N(),u.push({name:"conversation-create"})}},{icon:"close",color:"white",dense:!0}]}),u.push({name:"conversation-detail",params:{id:t.id}})}}catch(s){console.error("Failed to save conversation:",s),g.notify({type:"negative",message:`Failed to ${r.value?"update":"create"} conversation. Please try again.`,position:"top",timeout:4e3})}finally{q.value=!1}},O=()=>{r.value&&n.value?u.push({name:"conversation-detail",params:{id:n.value.id}}):u.push({name:"conversations"})},z=()=>{u.push({name:"conversations"})},M=()=>{r.value&&n.value&&u.push({name:"conversation-detail",params:{id:n.value.id}})};return G(()=>p.params.id,(s,t)=>{s&&s!==t&&Q()}),X(()=>{Q()}),(s,t)=>(d(),y(se,{view:"lHh Lpr lFf"},{default:l(()=>[a(ie,{onToggleDrawer:t[0]||(t[0]=e=>f.value=!f.value)}),a(re,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e)},null,8,["modelValue"]),a(ue,null,{default:l(()=>[a(de,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:l(()=>[_.value?(d(),h("div",ye,[a(W,{size:"50px",color:"primary"}),i("div",be,m(r.value?"Loading conversation details...":"Loading..."),1)])):x.value?(d(),h("div",ge,[a(w,{name:"error_outline",size:"80px",color:"negative"}),i("div",Ce,m(V.value),1),a(S,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:Q})])):(d(),h("div",_e,[i("div",qe,[a(oe,{class:"text-grey-6"},{default:l(()=>[a(T,{icon:"chat",label:"Conversations",onClick:z,class:"cursor-pointer"}),r.value?(d(),y(T,{key:0,label:n.value?.participants?.map(e=>e.name).join(", ")||"Conversation",onClick:M,class:"cursor-pointer"},null,8,["label"])):k("",!0),a(T,{label:r.value?"Edit":"Add Conversation"},null,8,["label"])]),_:1})]),i("div",xe,[i("div",Ve,[a(ce,{onSubmit:j,class:"q-gutter-md",autocomplete:"off"},{default:l(()=>[a(P,null,{default:l(()=>[a(D,null,{default:l(()=>[t[8]||(t[8]=i("div",{class:"text-h6 q-mb-md"},"Conversation Details",-1)),a(E,{modelValue:o.participants,"onUpdate:modelValue":t[2]||(t[2]=e=>o.participants=e),options:R.value,label:"Participants *",filled:"",multiple:"",required:"","option-value":"id","option-label":"name","emit-value":"","map-options":"","use-chips":"","stack-label":"",autocomplete:"off",class:"q-mb-md",rules:[e=>e&&e.length>0||"At least one participant is required"],onPopupShow:F},{"selected-item":l(e=>[a(le,{removable:"",onRemove:Se=>e.removeAtIndex(e.index),tabindex:e.tabindex,class:"q-ma-xs"},{default:l(()=>[I(m(e.opt.name),1)]),_:2},1032,["onRemove","tabindex"])]),_:1},8,["modelValue","options","rules"]),a(L,{modelValue:o.date,"onUpdate:modelValue":t[3]||(t[3]=e=>o.date=e),label:"Date *",type:"date",filled:"",required:"",autocomplete:"off",class:"q-mb-md",rules:[e=>!!e||"Date is required"]},null,8,["modelValue","rules"]),a(E,{modelValue:o.type,"onUpdate:modelValue":t[4]||(t[4]=e=>o.type=e),options:Z(ve),label:"Conversation Type *",filled:"",required:"","option-value":"value","option-label":"label","emit-value":"","map-options":"",autocomplete:"off",class:"q-mb-md",rules:[e=>!!e||"Conversation type is required"]},{"selected-item":l(e=>[e.opt.icon?(d(),y(b,{key:0,avatar:""},{default:l(()=>[a(w,{name:e.opt.icon},null,8,["name"])]),_:2},1024)):k("",!0),a(b,null,{default:l(()=>[a(U,null,{default:l(()=>[I(m(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),option:l(e=>[a(pe,ee(ae(e.itemProps)),{default:l(()=>[e.opt.icon?(d(),y(b,{key:0,avatar:""},{default:l(()=>[a(w,{name:e.opt.icon},null,8,["name"])]),_:2},1024)):k("",!0),a(b,null,{default:l(()=>[a(U,null,{default:l(()=>[I(m(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"]),a(L,{modelValue:o.location,"onUpdate:modelValue":t[5]||(t[5]=e=>o.location=e),label:"Location",hint:"Where did this conversation take place?",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"])]),_:1})]),_:1}),a(P,null,{default:l(()=>[a(D,null,{default:l(()=>[t[9]||(t[9]=i("div",{class:"text-h6 q-mb-md"},"Notes",-1)),a(L,{modelValue:o.notes,"onUpdate:modelValue":t[6]||(t[6]=e=>o.notes=e),label:"Conversation notes *",type:"textarea",rows:"6",filled:"",required:"",autocomplete:"off",hint:"What was discussed? Key topics, outcomes, follow-ups needed, etc.",class:"q-mb-md",rules:[e=>!!e||"Notes are required"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(P,null,{default:l(()=>[a(D,null,{default:l(()=>[t[10]||(t[10]=i("div",{class:"text-h6 q-mb-md"},"Privacy Settings",-1)),a(te,{modelValue:o.private,"onUpdate:modelValue":t[7]||(t[7]=e=>o.private=e),label:"Private conversation",color:"orange"},null,8,["modelValue"]),t[11]||(t[11]=i("div",{class:"text-caption text-grey-6 q-ml-lg"}," Private conversations are only visible to you ",-1))]),_:1})]),_:1}),i("div",Qe,[a(S,{flat:"",label:"Cancel",color:"grey-7",onClick:O}),a(S,{type:"submit",label:r.value?"Save Changes":"Add Conversation",color:"primary",loading:q.value},null,8,["label","loading"])])]),_:1})])])]))]),_:1})]),_:1})]),_:1}))}},Ue=H(he,[["__scopeId","data-v-be416ef0"]]);export{Ue as default};
