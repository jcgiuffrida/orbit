import{Q as S}from"./QSpinnerDots-D9CBjq5l.js";import{_ as U,d as b,c as D,H as E,I as A,e as F,f as h,w as s,B as $,o as c,b as a,a as V,D as g,h as r,i as L,t as N,j as _,n as T,l as w,m as q,C as d}from"./main-DJ_tSYHB.js";import{Q as j,a as x}from"./QBreadcrumbs-gqxnY20s.js";import{Q as H}from"./QForm-B5Acnp3o.js";import{f as O,u as z,_ as R,a as M,Q as G,b as J}from"./NavigationDrawer-CSW2CacQ.js";import{u as K}from"./people-8Dc0MwE0.js";const W={key:0,class:"text-center q-pa-xl"},X={key:1,class:"text-center q-pa-xl"},Y={class:"text-h6 text-negative q-mt-md"},Z={key:2},ee={class:"breadcrumb-nav q-mb-md"},ae={class:"row justify-center"},le={class:"col-12 col-md-8 col-lg-6"},oe={class:"row q-gutter-sm justify-end q-mt-lg"},te={__name:"PersonEditView",setup(se){const p=E(),m=$(),v=z(),u=K(),f=b(!1),y=b(!1),i=b(null),n=D(()=>p.params.id==="new"),l=A({name:"",name_ext:"",email:"",phone:"",location:"",birthday:"",how_we_met:"",notes:"",ai_summary:""}),P=async()=>{if(n.value)return;const t=p.params.id;if(t)try{await u.fetchPersonById(t),i.value=u.selectedPerson,i.value&&(Object.keys(l).forEach(e=>{l[e]=i.value[e]||""}),i.value.birthday&&(l.birthday=Q(i.value.birthday)))}catch(e){console.error("Failed to load person:",e)}},Q=t=>t?new Date(t).toISOString().split("T")[0]:"",C=async()=>{y.value=!0;try{const t={...l};if(t.birthday||(t.birthday=null),n.value){const e=await u.createPerson(t);v.notify({type:"positive",message:`Person ${e.name} created successfully`,position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),m.push({name:"person-detail",params:{id:e.id}})}else{const e=await u.updatePerson(i.value.id,t);v.notify({type:"positive",message:`${e.name} updated successfully`,position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),m.push({name:"person-detail",params:{id:i.value.id}})}}catch(t){console.error("Failed to save person:",t),v.notify({type:"negative",message:`Failed to ${n.value?"create":"update"} person. Please try again.`,position:"top",timeout:4e3})}finally{y.value=!1}},I=()=>{n.value?m.push({name:"people"}):m.push({name:"person-detail",params:{id:p.params.id}})},k=()=>{m.push({name:"people"})},B=()=>{!n.value&&p.params.id&&m.push({name:"person-detail",params:{id:p.params.id}})};return F(()=>{P()}),(t,e)=>(c(),h(O,{view:"lHh Lpr lFf"},{default:s(()=>[a(R,{onToggleDrawer:e[0]||(e[0]=o=>f.value=!f.value)}),a(M,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=o=>f.value=o)},null,8,["modelValue"]),a(G,null,{default:s(()=>[a(J,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[g(u).isLoading&&!n.value?(c(),V("div",W,[a(S,{size:"50px",color:"primary"}),e[11]||(e[11]=r("div",{class:"q-mt-md"},"Loading person details...",-1))])):g(u).hasError&&!n.value?(c(),V("div",X,[a(L,{name:"error_outline",size:"80px",color:"negative"}),r("div",Y,N(g(u).error),1),a(_,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:P})])):(c(),V("div",Z,[r("div",ee,[a(j,{class:"text-grey-6"},{default:s(()=>[a(x,{icon:"people",label:"People",onClick:k,class:"cursor-pointer"}),n.value?T("",!0):(c(),h(x,{key:0,label:i.value?.name||"Person",onClick:B,class:"cursor-pointer"},null,8,["label"])),a(x,{label:n.value?"Add Person":"Edit"},null,8,["label"])]),_:1})]),r("div",ae,[r("div",le,[a(H,{onSubmit:C,class:"q-gutter-md",autocomplete:"off"},{default:s(()=>[a(w,null,{default:s(()=>[a(q,null,{default:s(()=>[e[12]||(e[12]=r("div",{class:"text-h6 q-mb-md"},"Basic Information",-1)),a(d,{modelValue:l.name,"onUpdate:modelValue":e[2]||(e[2]=o=>l.name=o),label:"Full name *",filled:"",required:"",autocomplete:"off",class:"q-mb-md",rules:[o=>!!o||"Name is required"]},null,8,["modelValue","rules"]),a(d,{modelValue:l.name_ext,"onUpdate:modelValue":e[3]||(e[3]=o=>l.name_ext=o),label:"Additional context",hint:"e.g. Luca's dad",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),a(d,{modelValue:l.location,"onUpdate:modelValue":e[4]||(e[4]=o=>l.location=o),label:"Location",hint:"City or state",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"])]),_:1})]),_:1}),a(w,null,{default:s(()=>[a(q,null,{default:s(()=>[e[13]||(e[13]=r("div",{class:"text-h6 q-mb-md"},"Contact Information",-1)),a(d,{modelValue:l.email,"onUpdate:modelValue":e[5]||(e[5]=o=>l.email=o),label:"Email",type:"email",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),a(d,{modelValue:l.phone,"onUpdate:modelValue":e[6]||(e[6]=o=>l.phone=o),label:"Phone",type:"tel",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),a(d,{modelValue:l.birthday,"onUpdate:modelValue":e[7]||(e[7]=o=>l.birthday=o),label:"Birthday",type:"date",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"])]),_:1})]),_:1}),a(w,null,{default:s(()=>[a(q,null,{default:s(()=>[e[14]||(e[14]=r("div",{class:"text-h6 q-mb-md"},"Additional Information",-1)),a(d,{modelValue:l.how_we_met,"onUpdate:modelValue":e[8]||(e[8]=o=>l.how_we_met=o),label:"How we met",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),a(d,{modelValue:l.notes,"onUpdate:modelValue":e[9]||(e[9]=o=>l.notes=o),label:"Notes",type:"textarea",rows:"4",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),a(d,{modelValue:l.ai_summary,"onUpdate:modelValue":e[10]||(e[10]=o=>l.ai_summary=o),label:"AI Summary",type:"textarea",rows:"3",filled:"",autocomplete:"off",class:"q-mb-md",hint:"AI-generated summary of conversations and interactions"},null,8,["modelValue"])]),_:1})]),_:1}),r("div",oe,[a(_,{flat:"",label:"Cancel",color:"grey-7",onClick:I}),a(_,{type:"submit",label:n.value?"Add Person":"Save Changes",color:"primary",loading:y.value},null,8,["label","loading"])])]),_:1})])])]))]),_:1})]),_:1})]),_:1}))}},pe=U(te,[["__scopeId","data-v-ed1fa1a8"]]);export{pe as default};
