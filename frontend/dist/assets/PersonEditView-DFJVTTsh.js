import{Q as U}from"./QSpinnerDots-COME6D_6.js";import{_ as A,d as b,c as D,M as E,I as F,e as $,f as P,w as s,C as L,o as c,b as l,a as V,u as g,h as r,i as N,t as T,j as _,l as j,m as w,n as h,D as d}from"./main-BSNfDbTQ.js";import{Q as O,a as q}from"./QBreadcrumbs-CdOISPkB.js";import{Q as z}from"./QForm-DcMUIj_2.js";import{f as H,u as M,_ as R,a as G,Q as J,b as K}from"./NavigationDrawer-Cd3a0AvU.js";import{u as W}from"./people-BTbzMQ5w.js";const X={key:0,class:"text-center q-pa-xl"},Y={key:1,class:"text-center q-pa-xl"},Z={class:"text-h6 text-negative q-mt-md"},ee={key:2},ae={class:"breadcrumb-nav q-mb-md"},le={class:"row justify-center"},oe={class:"col-12 col-md-8 col-lg-6"},te={class:"row q-gutter-sm justify-end q-mt-lg"},se={__name:"PersonEditView",setup(ne){const p=E(),m=L(),y=M(),u=W(),f=b(!1),v=b(!1),i=b(null),n=D(()=>p.params.id==="new"),a=F({name:"",name_ext:"",email:"",phone:"",location:"",birthday:"",how_we_met:"",notes:"",ai_summary:""}),Q=()=>{a.name="",a.name_ext="",a.email="",a.phone="",a.location="",a.birthday="",a.how_we_met="",a.notes="",a.ai_summary=""},x=async()=>{if(n.value)return;const t=p.params.id;if(t)try{await u.fetchPersonById(t),i.value=u.selectedPerson,i.value&&(Object.keys(a).forEach(e=>{a[e]=i.value[e]||""}),i.value.birthday&&(a.birthday=C(i.value.birthday)))}catch(e){console.error("Failed to load person:",e)}},C=t=>t?new Date(t).toISOString().split("T")[0]:"",I=async()=>{v.value=!0;try{const t={...a};if(t.birthday||(t.birthday=null),n.value){const e=await u.createPerson(t);y.notify({type:"positive",message:`Person ${e.name} created successfully`,position:"top",timeout:6e3,actions:[{icon:"add",color:"white",dense:!0,label:"Add Another",handler:()=>{Q(),m.push({name:"person-edit",params:{id:"new"}})}},{icon:"close",color:"white",dense:!0}]}),m.push({name:"person-detail",params:{id:e.id}})}else{const e=await u.updatePerson(i.value.id,t);y.notify({type:"positive",message:`${e.name} updated successfully`,position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),m.push({name:"person-detail",params:{id:i.value.id}})}}catch(t){console.error("Failed to save person:",t),y.notify({type:"negative",message:`Failed to ${n.value?"create":"update"} person. Please try again.`,position:"top",timeout:4e3})}finally{v.value=!1}},k=()=>{n.value?m.push({name:"people"}):m.push({name:"person-detail",params:{id:p.params.id}})},B=()=>{m.push({name:"people"})},S=()=>{!n.value&&p.params.id&&m.push({name:"person-detail",params:{id:p.params.id}})};return $(()=>{x()}),(t,e)=>(c(),P(H,{view:"lHh Lpr lFf"},{default:s(()=>[l(R,{onToggleDrawer:e[0]||(e[0]=o=>f.value=!f.value)}),l(G,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=o=>f.value=o)},null,8,["modelValue"]),l(J,null,{default:s(()=>[l(K,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[g(u).isLoading&&!n.value?(c(),V("div",X,[l(U,{size:"50px",color:"primary"}),e[11]||(e[11]=r("div",{class:"q-mt-md"},"Loading person details...",-1))])):g(u).hasError&&!n.value?(c(),V("div",Y,[l(N,{name:"error_outline",size:"80px",color:"negative"}),r("div",Z,T(g(u).error),1),l(_,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:x})])):(c(),V("div",ee,[r("div",ae,[l(O,{class:"text-grey-6"},{default:s(()=>[l(q,{icon:"people",label:"People",onClick:B,class:"cursor-pointer"}),n.value?j("",!0):(c(),P(q,{key:0,label:i.value?.name||"Person",onClick:S,class:"cursor-pointer"},null,8,["label"])),l(q,{label:n.value?"Add Person":"Edit"},null,8,["label"])]),_:1})]),r("div",le,[r("div",oe,[l(z,{onSubmit:I,class:"q-gutter-md",autocomplete:"off"},{default:s(()=>[l(w,null,{default:s(()=>[l(h,null,{default:s(()=>[e[12]||(e[12]=r("div",{class:"text-h6 q-mb-md"},"Basic Information",-1)),l(d,{modelValue:a.name,"onUpdate:modelValue":e[2]||(e[2]=o=>a.name=o),label:"Full name *",filled:"",required:"",autocomplete:"off",class:"q-mb-md",rules:[o=>!!o||"Name is required"]},null,8,["modelValue","rules"]),l(d,{modelValue:a.name_ext,"onUpdate:modelValue":e[3]||(e[3]=o=>a.name_ext=o),label:"Additional context",hint:"e.g. Luca's dad",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),l(d,{modelValue:a.location,"onUpdate:modelValue":e[4]||(e[4]=o=>a.location=o),label:"Location",hint:"City or state",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"])]),_:1})]),_:1}),l(w,null,{default:s(()=>[l(h,null,{default:s(()=>[e[13]||(e[13]=r("div",{class:"text-h6 q-mb-md"},"Contact Information",-1)),l(d,{modelValue:a.email,"onUpdate:modelValue":e[5]||(e[5]=o=>a.email=o),label:"Email",type:"email",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),l(d,{modelValue:a.phone,"onUpdate:modelValue":e[6]||(e[6]=o=>a.phone=o),label:"Phone",type:"tel",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),l(d,{modelValue:a.birthday,"onUpdate:modelValue":e[7]||(e[7]=o=>a.birthday=o),label:"Birthday",type:"date",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"])]),_:1})]),_:1}),l(w,null,{default:s(()=>[l(h,null,{default:s(()=>[e[14]||(e[14]=r("div",{class:"text-h6 q-mb-md"},"Additional Information",-1)),l(d,{modelValue:a.how_we_met,"onUpdate:modelValue":e[8]||(e[8]=o=>a.how_we_met=o),label:"How we met",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),l(d,{modelValue:a.notes,"onUpdate:modelValue":e[9]||(e[9]=o=>a.notes=o),label:"Notes",type:"textarea",rows:"4",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),l(d,{modelValue:a.ai_summary,"onUpdate:modelValue":e[10]||(e[10]=o=>a.ai_summary=o),label:"AI Summary",type:"textarea",rows:"3",filled:"",autocomplete:"off",class:"q-mb-md",hint:"AI-generated summary of conversations and interactions"},null,8,["modelValue"])]),_:1})]),_:1}),r("div",te,[l(_,{flat:"",label:"Cancel",color:"grey-7",onClick:k}),l(_,{type:"submit",label:n.value?"Add Person":"Save Changes",color:"primary",loading:v.value},null,8,["label","loading"])])]),_:1})])])]))]),_:1})]),_:1})]),_:1}))}},ce=A(se,[["__scopeId","data-v-f5013a24"]]);export{ce as default};
