import{Q as G}from"./QSpinnerDots-C2No3ue-.js";import{_ as K,d as m,c as F,M as X,I as Y,J as Z,e as tt,f,w as l,C as et,o as u,b as t,a as P,h as r,t as c,i as h,j as S,l as _,m as T,n as D,P as E,R as U,k as g,D as N,u as at,S as $}from"./main-BUattiJr.js";import{Q as ot,a as L}from"./QBreadcrumbs-Cw60VNnf.js";import{Q as q}from"./QItemLabel-C8FJA7k9.js";import{f as lt,u as st,_ as nt,a as rt,Q as it,b as ut,d as O,e as v}from"./NavigationDrawer-CuUZiH8A.js";import{Q as R}from"./QSelect-D_7hzanl.js";import{Q as pt}from"./QForm-BkF9IiGO.js";import{u as dt,c as mt}from"./contactAttempts-NlcEZ8oZ.js";import{u as ct}from"./people-dIeVvlE2.js";import"./QChip-bPL42vie.js";const ft={key:0,class:"text-center q-pa-xl"},vt={class:"q-mt-md"},yt={key:1,class:"text-center q-pa-xl"},bt={class:"text-h6 text-negative q-mt-md"},Ct={key:2},_t={class:"breadcrumb-nav q-mb-md"},gt={class:"row justify-center"},qt={class:"col-12 col-md-8 col-lg-6"},Vt={class:"row q-gutter-sm justify-end q-mt-lg"},At={__name:"ContactAttemptCreateView",setup(Qt){const d=X(),p=et(),y=st(),b=dt(),V=ct(),C=m(!1),A=m(!1),Q=m(!1),w=m(!1),x=m(null),n=m(null),i=F(()=>d.params.id&&d.params.id!=="new"),o=Y({person:"",date:new Date().toISOString().split("T")[0],type:"",notes:"",ledToConversation:!1,private:!1}),j=F(()=>V.getPeopleList),I=s=>{A.value=s,s&&(w.value=!1,x.value=null)},z=s=>{w.value=!0,x.value=s,A.value=!1},B=async()=>{if(V.getPeopleList.length===0)try{await V.fetchPeople()}catch(s){console.error("Failed to load people:",s)}},k=async()=>{I(!0);try{if(await B(),d.query.person&&(o.person=d.query.person),i.value){const s=d.params.id;await b.fetchContactAttemptById(s),n.value=b.selectedContactAttempt,n.value&&(o.person=n.value.person,o.date=n.value.date,o.type=n.value.type,o.notes=n.value.notes||"",o.ledToConversation=!!n.value.led_to_conversation,o.private=n.value.private||!1)}}catch(s){console.error("Failed to load data:",s),z("Failed to load data")}finally{I(!1)}},M=async()=>{Q.value=!0;try{const s={person:o.person,date:o.date,type:o.type,notes:o.notes||"",private:o.private};if(i.value){const a=await b.updateContactAttempt(n.value.id,s);y.notify({type:"positive",message:"Contact attempt updated successfully",position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),p.push({name:"contact-attempts"})}else{const a=await b.createContactAttempt(s);y.notify({type:"positive",message:"Contact attempt added successfully",position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),o.ledToConversation?y.dialog({title:"Create Conversation",message:"Would you like to create a conversation record based on this contact attempt?",cancel:!0,persistent:!1}).onOk(()=>{p.push({name:"conversation-create",query:{participants:o.person,from_attempt:a.id,type:o.type==="call"?"phone":o.type,date:o.date}})}).onCancel(()=>{p.push({name:"contact-attempts"})}):p.push({name:"contact-attempts"})}}catch(s){console.error("Failed to save contact attempt:",s),y.notify({type:"negative",message:`Failed to ${i.value?"update":"create"} contact attempt. Please try again.`,position:"top",timeout:4e3})}finally{Q.value=!1}},W=()=>{p.push({name:"contact-attempts"})},H=()=>{p.push({name:"contact-attempts"})},J=()=>{i.value&&n.value&&p.push({name:"contact-attempt-detail",params:{id:n.value.id}})};return Z(()=>d.params.id,(s,a)=>{s&&s!==a&&k()}),tt(()=>{k()}),(s,a)=>(u(),f(lt,{view:"lHh Lpr lFf"},{default:l(()=>[t(nt,{onToggleDrawer:a[0]||(a[0]=e=>C.value=!C.value)}),t(rt,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value=e)},null,8,["modelValue"]),t(it,null,{default:l(()=>[t(ut,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:l(()=>[A.value?(u(),P("div",ft,[t(G,{size:"50px",color:"primary"}),r("div",vt,c(i.value?"Loading contact attempt details...":"Loading..."),1)])):w.value?(u(),P("div",yt,[t(h,{name:"error_outline",size:"80px",color:"negative"}),r("div",bt,c(x.value),1),t(S,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:k})])):(u(),P("div",Ct,[r("div",_t,[t(ot,{class:"text-grey-6"},{default:l(()=>[t(L,{icon:"contact_phone",label:"Contact Attempts",onClick:H,class:"cursor-pointer"}),i.value&&n.value?(u(),f(L,{key:0,label:`${n.value.person_name||"Contact Attempt"}`,onClick:J,class:"cursor-pointer"},null,8,["label"])):_("",!0),t(L,{label:i.value?"Edit":"Add Contact Attempt"},null,8,["label"])]),_:1})]),r("div",gt,[r("div",qt,[t(pt,{onSubmit:M,class:"q-gutter-md",autocomplete:"off"},{default:l(()=>[t(T,null,{default:l(()=>[t(D,null,{default:l(()=>[a[8]||(a[8]=r("div",{class:"text-h6 q-mb-md"},"Contact Attempt Details",-1)),t(R,{modelValue:o.person,"onUpdate:modelValue":a[2]||(a[2]=e=>o.person=e),options:j.value,label:"Person *",filled:"",required:"","option-value":"id","option-label":"name","emit-value":"","map-options":"",autocomplete:"off",class:"q-mb-md",rules:[e=>!!e||"Person is required"],onPopupShow:B},{option:l(e=>[t(O,E(U(e.itemProps)),{default:l(()=>[t(v,null,{default:l(()=>[t(q,null,{default:l(()=>[g(c(e.opt.name),1)]),_:2},1024),e.opt.name_ext?(u(),f(q,{key:0,caption:""},{default:l(()=>[g(c(e.opt.name_ext),1)]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"]),t(N,{modelValue:o.date,"onUpdate:modelValue":a[3]||(a[3]=e=>o.date=e),label:"Date *",type:"date",filled:"",required:"",autocomplete:"off",class:"q-mb-md",rules:[e=>!!e||"Date is required"]},null,8,["modelValue","rules"]),t(R,{modelValue:o.type,"onUpdate:modelValue":a[4]||(a[4]=e=>o.type=e),options:at(mt),label:"Contact Type *",filled:"",required:"","option-value":"value","option-label":"label","emit-value":"","map-options":"",autocomplete:"off",class:"q-mb-md",rules:[e=>!!e||"Contact type is required"]},{"selected-item":l(e=>[e.opt.icon?(u(),f(v,{key:0,avatar:""},{default:l(()=>[t(h,{name:e.opt.icon},null,8,["name"])]),_:2},1024)):_("",!0),t(v,null,{default:l(()=>[t(q,null,{default:l(()=>[g(c(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),option:l(e=>[t(O,E(U(e.itemProps)),{default:l(()=>[e.opt.icon?(u(),f(v,{key:0,avatar:""},{default:l(()=>[t(h,{name:e.opt.icon},null,8,["name"])]),_:2},1024)):_("",!0),t(v,null,{default:l(()=>[t(q,null,{default:l(()=>[g(c(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),_:1})]),_:1}),t(T,null,{default:l(()=>[t(D,null,{default:l(()=>[a[9]||(a[9]=r("div",{class:"text-h6 q-mb-md"},"Notes",-1)),t(N,{modelValue:o.notes,"onUpdate:modelValue":a[5]||(a[5]=e=>o.notes=e),label:"Notes",type:"textarea",rows:"4",filled:"",autocomplete:"off",hint:"What was the purpose? Any response or outcome?",class:"q-mb-md"},null,8,["modelValue"])]),_:1})]),_:1}),t(T,null,{default:l(()=>[t(D,null,{default:l(()=>[a[10]||(a[10]=r("div",{class:"text-h6 q-mb-md"},"Follow-up & Privacy",-1)),t($,{modelValue:o.ledToConversation,"onUpdate:modelValue":a[6]||(a[6]=e=>o.ledToConversation=e),label:"This led to a conversation",color:"positive",class:"q-mb-md"},null,8,["modelValue"]),a[11]||(a[11]=r("br",null,null,-1)),t($,{modelValue:o.private,"onUpdate:modelValue":a[7]||(a[7]=e=>o.private=e),label:"Private contact attempt",color:"orange"},null,8,["modelValue"]),a[12]||(a[12]=r("div",{class:"text-caption text-grey-6 q-ml-lg"}," Private contact attempts are only visible to you ",-1))]),_:1})]),_:1}),r("div",Vt,[t(S,{flat:"",label:"Cancel",color:"grey-7",onClick:W}),t(S,{type:"submit",label:i.value?"Save Changes":"Add Contact Attempt",color:"primary",loading:Q.value},null,8,["label","loading"])])]),_:1})])])]))]),_:1})]),_:1})]),_:1}))}},Bt=K(At,[["__scopeId","data-v-fbcc6d08"]]);export{Bt as default};
