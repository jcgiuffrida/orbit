import{_ as A,d as q,c as B,e as E,f as h,w as l,D as R,o as s,b as a,h as u,a as i,l as m,j as w,E as I,i as _,u as p,t as c,F as O,p as U,m as j,n as Y,k as f,s as Z,q as G,G as D}from"./main-BNYyCrAV.js";import{Q as H}from"./QSelect-D7AnBUJS.js";import{Q as J}from"./QSpinnerDots-DKX6m9Q8.js";import{Q}from"./QTooltip-DaHthXlo.js";import{f as K,u as W,_ as X,a as ee,Q as te,b as oe}from"./NavigationDrawer-CoZBpgI1.js";import{u as ae}from"./people-DXZZurFb.js";import"./QItemLabel-Co7gJjbr.js";import"./position-engine--pu8bc_Q.js";const se={class:"row items-center q-mb-lg"},ne={class:"row q-col-gutter-md q-mb-lg"},le={class:"col-12 col-md-8"},ie={class:"col-12 col-md-4"},re={key:0,class:"text-center q-pa-lg"},ce={key:1,class:"text-center q-pa-xl"},de={class:"text-h6 text-grey-7 q-mt-md"},ue={key:2,class:"row q-col-gutter-md"},me={class:"text-h6 q-mb-xs"},pe={key:0,class:"text-caption text-grey-7 q-mb-sm"},fe={key:1,class:"text-body2 text-grey-8 q-mb-sm"},ye={key:2,class:"text-body2 text-grey-8 q-mb-sm"},_e={key:4,class:"text-caption text-grey-6"},ge={key:3,class:"row items-center justify-center q-mt-lg"},ve={class:"text-body2 text-grey-6"},we={key:0},xe={__name:"PeopleView",setup(he){const C=R(),g=W(),r=ae(),x=q(!1),y=q(""),k=q("name"),P=[{label:"Name (A-Z)",value:"name"},{label:"Name (Z-A)",value:"-name"},{label:"Recently Contacted",value:"-last_contacted"},{label:"Least Recently Contacted",value:"last_contacted"}],b=B(()=>{let o=[...r.getPeopleList];if(y.value){const t=y.value.toLowerCase().trim();o=o.filter(e=>e.name.toLowerCase().includes(t)||e.name_ext&&e.name_ext.toLowerCase().includes(t)||e.location&&e.location.toLowerCase().includes(t)||e.company&&e.company.toLowerCase().includes(t))}return o.sort((t,e)=>{switch(k.value){case"name":return t.name.localeCompare(e.name);case"-name":return e.name.localeCompare(t.name);case"-last_contacted":return!t.last_contacted&&!e.last_contacted?0:t.last_contacted?e.last_contacted?new Date(e.last_contacted)-new Date(t.last_contacted):-1:1;case"last_contacted":return!t.last_contacted&&!e.last_contacted?0:t.last_contacted?e.last_contacted?new Date(t.last_contacted)-new Date(e.last_contacted):-1:1;default:return 0}}),o}),L=async()=>{try{const o=r.peopleCount===1;await r.fetchPeople(o)}catch(o){console.error("Error loading people:",o)}},V=o=>{if(!o)return"Never";const t=new Date(o),d=new Date-t,n=Math.floor(d/(1e3*60*60*24));if(n===0)return"Today";if(n===1)return"Yesterday";if(n<7)return n===1?"1 day ago":`${n} days ago`;if(n<30){const v=Math.floor(n/7);return v===1?"1 week ago":`${v} weeks ago`}if(n<365){const v=Math.floor(n/30);return v===1?"1 month ago":`${v} months ago`}return t.toLocaleDateString()},N=async o=>{if(!o.email){g.notify({type:"warning",message:`No email address available for ${o.name}`,position:"top",timeout:3e3});return}try{await navigator.clipboard.writeText(o.email),g.notify({type:"positive",message:`Email copied: ${o.email}`,position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]})}catch(t){console.error("Failed to copy email:",t),g.notify({type:"negative",message:"Failed to copy email address",position:"top",timeout:3e3})}},z=o=>{C.push({name:"person-detail",params:{id:o.id}})},S=o=>{o.phone?(window.open(`sms:${o.phone}`),g.notify({type:"info",message:`Opening SMS to ${o.name}`,position:"top",timeout:2e3})):g.notify({type:"warning",message:`No phone number available for ${o.name}`,position:"top",timeout:3e3})},$=()=>{C.push({name:"person-edit",params:{id:"new"}})},T=o=>{C.push({name:"conversation-create",query:{participants:o.id}})},M=o=>{if(!o)return"grey-6";const t=new Date(o),d=new Date-t,n=Math.floor(d/(1e3*60*60*24));return n<=60?"positive":n<=180?"grey-7":"negative"},F=o=>{if(!o)return"text-grey-6";const t=new Date(o),d=new Date-t,n=Math.floor(d/(1e3*60*60*24));return n<=60?"text-positive":n<=180?"text-grey-8":"text-negative"};return E(()=>{L()}),(o,t)=>(s(),h(K,{view:"lHh Lpr lFf"},{default:l(()=>[a(X,{onToggleDrawer:t[0]||(t[0]=e=>x.value=!x.value)}),a(ee,{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=e=>x.value=e)},null,8,["modelValue"]),a(te,null,{default:l(()=>[a(oe,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:l(()=>[u("div",se,[t[4]||(t[4]=u("div",{class:"text-h4 col"},"People",-1)),a(w,{color:"primary",icon:"add",label:"Add Person",onClick:$})]),u("div",ne,[u("div",le,[a(I,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=e=>y.value=e),filled:"",placeholder:"Search people...",clearable:""},{prepend:l(()=>[a(_,{name:"search"})]),_:1},8,["modelValue"])]),u("div",ie,[a(H,{modelValue:k.value,"onUpdate:modelValue":[t[3]||(t[3]=e=>k.value=e),L],filled:"",options:P,label:"Sort by","emit-value":"","map-options":""},null,8,["modelValue"])])]),p(r).isLoading?(s(),i("div",re,[a(J,{size:"50px",color:"primary"}),t[5]||(t[5]=u("div",{class:"q-mt-md"},"Loading people...",-1))])):b.value.length===0?(s(),i("div",ce,[a(_,{name:"people_outline",size:"80px",color:"grey-5"}),u("div",de,c(y.value?"No people found matching your search":"No people added yet"),1),y.value?m("",!0):(s(),h(w,{key:0,color:"primary",label:"Add Your First Person",class:"q-mt-md",onClick:$}))])):(s(),i("div",ue,[(s(!0),i(O,null,U(b.value,e=>(s(),i("div",{key:e.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[a(j,{class:"person-card full-height cursor-pointer flex column",onClick:d=>z(e)},{default:l(()=>[a(Y,{class:"flex-grow-1"},{default:l(()=>[u("div",me,c(e.name),1),e.name_ext?(s(),i("div",pe,c(e.name_ext),1)):m("",!0),e.location?(s(),i("div",fe,[a(_,{name:"place",size:"16px",class:"q-mr-xs"}),f(" "+c(e.location),1)])):m("",!0),e.company?(s(),i("div",ye,[a(_,{name:"business",size:"16px",class:"q-mr-xs"}),f(" "+c(e.company),1)])):m("",!0),e.last_contacted?(s(),i("div",{key:3,class:Z(["text-caption",F(e.last_contacted)])},[a(_,{name:"schedule",size:"14px",class:"q-mr-xs",color:M(e.last_contacted)},null,8,["color"]),f(" Last contact: "+c(V(e.last_contacted)),1)],2)):(s(),i("div",_e,[a(_,{name:"schedule",size:"14px",class:"q-mr-xs"}),t[6]||(t[6]=f(" No contact recorded ",-1))]))]),_:2},1024),a(G,{align:"right"},{default:l(()=>[e.email?(s(),h(w,{key:0,flat:"",round:"",size:"md",icon:"email",color:"info",onClick:D(d=>N(e),["stop"])},{default:l(()=>[a(Q,null,{default:l(()=>[...t[7]||(t[7]=[f("Copy Email Address",-1)])]),_:1})]),_:2},1032,["onClick"])):m("",!0),e.phone?(s(),h(w,{key:1,flat:"",round:"",size:"md",icon:"sms",color:"info",onClick:D(d=>S(e),["stop"])},{default:l(()=>[a(Q,null,{default:l(()=>[...t[8]||(t[8]=[f("Send Text Message",-1)])]),_:1})]),_:2},1032,["onClick"])):m("",!0),a(w,{flat:"",round:"",size:"md",icon:"add",color:"primary",onClick:D(d=>T(e),["stop"])},{default:l(()=>[a(Q,null,{default:l(()=>[...t[9]||(t[9]=[f("Log Conversation",-1)])]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])),p(r).people.length>0?(s(),i("div",ge,[u("div",ve,[f(" Showing "+c(b.value.length)+" of "+c(p(r).people.length)+" people ",1),p(r).pagination.count&&p(r).pagination.count!==p(r).people.length?(s(),i("span",we," ("+c(p(r).people.length)+" of "+c(p(r).pagination.count)+" total loaded) ",1)):m("",!0)])])):m("",!0)]),_:1})]),_:1})]),_:1}))}},Pe=A(xe,[["__scopeId","data-v-4b6bbe8b"]]);export{Pe as default};
