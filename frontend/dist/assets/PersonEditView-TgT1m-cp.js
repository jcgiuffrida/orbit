import{Q as z}from"./QSpinnerDots-BsIIeB5d.js";import{_ as H,d as p,c as R,M as G,I as K,e as W,f as S,w as n,u as X,o as f,b as l,a as C,m as w,h as i,i as Z,t as ee,j as P,l as ae,n as Q,p as k,E as d,k as F}from"./main-BtbfkAaC.js";import{Q as le,a as D}from"./QBreadcrumbs-D-UkWGgU.js";import{f as oe,u as te,_ as se,a as ne,Q as ie,b as re,d as U,e as M}from"./NavigationDrawer-DiYLZfbT.js";import{Q as g}from"./QSelect-CG3_3xNS.js";import{Q as de}from"./QForm-CbK6kz7O.js";import{u as ue}from"./people-CpNVsY3R.js";import"./QItemLabel-eG93G_dM.js";import"./position-engine-C8qud-4P.js";const me={key:0,class:"text-center q-pa-xl"},pe={key:1,class:"text-center q-pa-xl"},ce={class:"text-h6 text-negative q-mt-md"},fe={key:2},be={class:"breadcrumb-nav q-mb-md"},ve={class:"row justify-center"},ye={class:"col-12 col-md-8 col-lg-6"},he={class:"row q-gutter-md q-mb-md"},_e={class:"col"},we={class:"col-3"},ge={class:"col-3"},Ve={class:"row q-gutter-sm justify-end q-mt-lg"},xe={__name:"PersonEditView",setup(qe){const c=G(),u=X(),V=te(),m=ue(),b=p(!1),x=p(!1),s=p(null),r=R(()=>c.params.id==="new"),e=K({name:"",name_ext:"",email:"",phone:"",location:"",address:"",company:"",birthdayMonth:null,birthdayDay:null,birthYear:null,how_we_met:"",notes:"",ai_summary:""}),A=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],I=Array.from({length:31},(t,a)=>({value:a+1,label:(a+1).toString()})),v=p([]),y=p([]),h=p([]),_=p([]),B=()=>{e.name="",e.name_ext="",e.email="",e.phone="",e.location="",e.address="",e.company="",e.birthdayMonth=null,e.birthdayDay=null,e.birthYear=null,e.how_we_met="",e.notes="",e.ai_summary=""},L=async()=>{if(r.value)return;const t=c.params.id;if(t)try{await m.fetchPersonById(t),s.value=m.selectedPerson,s.value&&(e.name=s.value.name||"",e.name_ext=s.value.name_ext||"",e.email=s.value.email||"",e.phone=s.value.phone||"",e.location=s.value.location||"",e.address=s.value.address||"",e.company=s.value.company||"",e.how_we_met=s.value.how_we_met||"",e.notes=s.value.notes||"",e.ai_summary=s.value.ai_summary||"",e.birthdayMonth=s.value.birthday_month||null,e.birthdayDay=s.value.birthday_day||null,e.birthYear=s.value.birth_year||null)}catch(a){console.error("Failed to load person:",a)}},O=async()=>{x.value=!0;try{const t={name:e.name,name_ext:e.name_ext,email:e.email,phone:e.phone,location:e.location===null?"":e.location,address:e.address,company:e.company===null?"":e.company,birthday_month:e.birthdayMonth,birthday_day:e.birthdayDay,birth_year:e.birthYear,how_we_met:e.how_we_met,notes:e.notes,ai_summary:e.ai_summary};if(r.value){const a=await m.createPerson(t);V.notify({type:"positive",message:`Person ${a.name} created successfully`,position:"top",timeout:6e3,actions:[{icon:"add",color:"white",dense:!0,label:"Add Another",handler:()=>{B(),u.push({name:"person-edit",params:{id:"new"}})}},{icon:"close",color:"white",dense:!0}]}),u.push({name:"person-detail",params:{id:a.id}})}else{const a=await m.updatePerson(s.value.id,t);V.notify({type:"positive",message:`${a.name} updated successfully`,position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),u.push({name:"person-detail",params:{id:s.value.id}})}}catch(t){console.error("Failed to save person:",t),V.notify({type:"negative",message:`Failed to ${r.value?"create":"update"} person. Please try again.`,position:"top",timeout:4e3})}finally{x.value=!1}},E=()=>{r.value?u.push({name:"people"}):u.push({name:"person-detail",params:{id:c.params.id}})},Y=()=>{u.push({name:"people"})},N=()=>{!r.value&&c.params.id&&u.push({name:"person-detail",params:{id:c.params.id}})},T=async()=>{try{const a=await(await fetch("/api/suggestions/locations/")).json();v.value=a.locations||[],h.value=[...v.value]}catch(t){console.error("Failed to load location suggestions:",t)}},$=async()=>{try{const a=await(await fetch("/api/suggestions/companies/")).json();y.value=a.companies||[],_.value=[...y.value]}catch(t){console.error("Failed to load company suggestions:",t)}},j=(t,a)=>{a(()=>{if(t==="")h.value=[...v.value];else{const o=t.toLowerCase();h.value=v.value.filter(q=>q.toLowerCase().indexOf(o)>-1)}})},J=(t,a)=>{a(()=>{if(t==="")_.value=[...y.value];else{const o=t.toLowerCase();_.value=y.value.filter(q=>q.toLowerCase().indexOf(o)>-1)}})};return W(()=>{L(),T(),$()}),(t,a)=>(f(),S(oe,{view:"lHh Lpr lFf"},{default:n(()=>[l(se,{onToggleDrawer:a[0]||(a[0]=o=>b.value=!b.value)}),l(ne,{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=o=>b.value=o)},null,8,["modelValue"]),l(ie,null,{default:n(()=>[l(re,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:n(()=>[w(m).isLoading&&!r.value?(f(),C("div",me,[l(z,{size:"50px",color:"primary"}),a[14]||(a[14]=i("div",{class:"q-mt-md"},"Loading person details...",-1))])):w(m).hasError&&!r.value?(f(),C("div",pe,[l(Z,{name:"error_outline",size:"80px",color:"negative"}),i("div",ce,ee(w(m).error),1),l(P,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:L})])):(f(),C("div",fe,[i("div",be,[l(le,{class:"text-grey-6"},{default:n(()=>[l(D,{icon:"people",label:"People",onClick:Y,class:"cursor-pointer"}),r.value?ae("",!0):(f(),S(D,{key:0,label:s.value?.name||"Person",onClick:N,class:"cursor-pointer"},null,8,["label"])),l(D,{label:r.value?"Add Person":"Edit"},null,8,["label"])]),_:1})]),i("div",ve,[i("div",ye,[l(de,{onSubmit:O,class:"q-gutter-md",autocomplete:"off"},{default:n(()=>[l(Q,null,{default:n(()=>[l(k,null,{default:n(()=>[a[17]||(a[17]=i("div",{class:"text-h6 q-mb-md"},"Basic Information",-1)),l(d,{modelValue:e.name,"onUpdate:modelValue":a[2]||(a[2]=o=>e.name=o),label:"Full name *",filled:"",required:"",autocomplete:"off",class:"q-mb-md",rules:[o=>!!o||"Name is required"]},null,8,["modelValue","rules"]),l(d,{modelValue:e.name_ext,"onUpdate:modelValue":a[3]||(a[3]=o=>e.name_ext=o),label:"Additional context",hint:"e.g. Luca's dad",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),l(g,{modelValue:e.location,"onUpdate:modelValue":a[4]||(a[4]=o=>e.location=o),label:"Location",hint:"City or state",filled:"","use-input":"",clearable:"","input-debounce":"0","new-value-mode":"add-unique",options:h.value,onFilter:j,class:"q-mb-md"},{"no-option":n(()=>[l(U,null,{default:n(()=>[l(M,{class:"text-grey"},{default:n(()=>[...a[15]||(a[15]=[F(" Type to add new location ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options"]),l(g,{modelValue:e.company,"onUpdate:modelValue":a[5]||(a[5]=o=>e.company=o),label:"Company",filled:"","use-input":"",clearable:"","input-debounce":"0","new-value-mode":"add-unique",options:_.value,onFilter:J,class:"q-mb-md"},{"no-option":n(()=>[l(U,null,{default:n(()=>[l(M,{class:"text-grey"},{default:n(()=>[...a[16]||(a[16]=[F(" Type to add new company ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),l(Q,null,{default:n(()=>[l(k,null,{default:n(()=>[a[18]||(a[18]=i("div",{class:"text-h6 q-mb-md"},"Contact Information",-1)),l(d,{modelValue:e.email,"onUpdate:modelValue":a[6]||(a[6]=o=>e.email=o),label:"Email",type:"email",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),l(d,{modelValue:e.phone,"onUpdate:modelValue":a[7]||(a[7]=o=>e.phone=o),label:"Phone",type:"tel",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),l(d,{modelValue:e.address,"onUpdate:modelValue":a[8]||(a[8]=o=>e.address=o),label:"Address",type:"textarea",filled:"",autocomplete:"off",class:"q-mb-md",rows:"3"},null,8,["modelValue"]),a[19]||(a[19]=i("div",{class:"text-subtitle2 q-mb-sm"},"Birthday",-1)),i("div",he,[i("div",_e,[l(g,{modelValue:e.birthdayMonth,"onUpdate:modelValue":a[9]||(a[9]=o=>e.birthdayMonth=o),options:A,label:"Month",filled:"",clearable:"",autocomplete:"off","option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue"])]),i("div",we,[l(g,{modelValue:e.birthdayDay,"onUpdate:modelValue":a[10]||(a[10]=o=>e.birthdayDay=o),options:w(I),label:"Day",filled:"",clearable:"",autocomplete:"off","option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","options"])]),i("div",ge,[l(d,{modelValue:e.birthYear,"onUpdate:modelValue":a[11]||(a[11]=o=>e.birthYear=o),modelModifiers:{number:!0},label:"Year",type:"number",filled:"",clearable:"",autocomplete:"off",hint:"Leave blank if unknown",min:"1900",max:new Date().getFullYear()},null,8,["modelValue","max"])])])]),_:1})]),_:1}),l(Q,null,{default:n(()=>[l(k,null,{default:n(()=>[a[20]||(a[20]=i("div",{class:"text-h6 q-mb-md"},"Additional Information",-1)),l(d,{modelValue:e.how_we_met,"onUpdate:modelValue":a[12]||(a[12]=o=>e.how_we_met=o),label:"How we met",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"]),l(d,{modelValue:e.notes,"onUpdate:modelValue":a[13]||(a[13]=o=>e.notes=o),label:"Notes",type:"textarea",rows:"4",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"])]),_:1})]),_:1}),i("div",Ve,[l(P,{flat:"",label:"Cancel",color:"grey-7",onClick:E}),l(P,{type:"submit",label:r.value?"Add Person":"Save Changes",color:"primary",loading:x.value},null,8,["label","loading"])])]),_:1})])])]))]),_:1})]),_:1})]),_:1}))}},Me=H(xe,[["__scopeId","data-v-7dae1f2c"]]);export{Me as default};
