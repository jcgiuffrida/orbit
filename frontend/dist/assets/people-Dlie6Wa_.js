import{g,H as C,d as f,c as y}from"./main-C8eLUZHf.js";const d={async getAll(t={}){try{return(await g.get("people/",{params:t})).data}catch(n){throw n}},async getById(t){try{return(await g.get(`people/${t}/`)).data}catch(n){throw n}},async create(t){try{return(await g.post("people/",t)).data}catch(n){throw n}},async update(t,n){try{return(await g.put(`people/${t}/`,n)).data}catch(u){throw u}},async partialUpdate(t,n){try{return(await g.patch(`people/${t}/`,n)).data}catch(u){throw u}},async delete(t){try{return(await g.delete(`people/${t}/`)).data}catch(n){throw n}}},H=C("people",()=>{const t=f([]),n=f(!1),u=f(null),h=f(null),l=f(null),c=f({count:0,next:null,previous:null,currentPage:1,totalPages:1,hasMore:!1}),M=300*1e3,U=y(()=>n.value),F=y(()=>!!u.value),S=y(()=>t.value.length),A=y(()=>t.value),m=y(()=>r=>t.value.find(a=>a.id===r)),x=y(()=>h.value?new Date().getTime()-h.value<M:!1),i=()=>{u.value=null},s=r=>{n.value=r},v=r=>{u.value=r,n.value=!1},E=async(r=!1,a={})=>{if(!r&&x.value&&t.value.length>0)return t.value;s(!0),i();try{const e=await d.getAll(a);if(e.results){let o=[...e.results];c.value={count:e.count,next:e.next,previous:e.previous,currentPage:a.page||1,totalPages:Math.ceil(e.count/(e.results.length||50)),hasMore:!!e.next};let p=e.next;for(;p;)try{const I=new URL(p).searchParams.get("page"),P=await d.getAll({...a,page:I});if(P.results)o=[...o,...P.results],p=P.next,c.value={...c.value,next:P.next,currentPage:parseInt(I),hasMore:!!P.next};else break}catch(w){console.error("Error fetching additional page:",w);break}t.value=o,c.value.hasMore=!1}else t.value=e,c.value={count:e.length,next:null,previous:null,currentPage:1,totalPages:1,hasMore:!1};return h.value=new Date().getTime(),t.value}catch(e){throw console.error("Error fetching people:",e),v(e.response?.data?.message||"Failed to load people"),e}finally{s(!1)}};return{people:t,loading:n,error:u,selectedPerson:l,pagination:c,isLoading:U,hasError:F,peopleCount:S,getPeopleList:A,getPersonById:m,isCacheValid:x,clearError:i,fetchPeople:E,loadMorePeople:async()=>{if(!(!c.value.hasMore||n.value)){s(!0),i();try{const a=new URL(c.value.next).searchParams.get("page"),e=await d.getAll({page:a});return e.results&&(t.value=[...t.value,...e.results],c.value={count:e.count,next:e.next,previous:e.previous,currentPage:parseInt(a),totalPages:Math.ceil(e.count/(e.results.length||50)),hasMore:!!e.next}),h.value=new Date().getTime(),t.value}catch(r){throw console.error("Error loading more people:",r),v(r.response?.data?.message||"Failed to load more people"),r}finally{s(!1)}}},fetchPersonById:async(r,a=!1)=>{const e=m.value(r);if(!a&&e&&x.value)return l.value=e,e;s(!0),i();try{const o=await d.getById(r),p=t.value.findIndex(w=>w.id===r);return p!==-1?t.value[p]=o:t.value.push(o),l.value=o,h.value=new Date().getTime(),o}catch(o){throw console.error("Error fetching person:",o),v(o.response?.data?.message||"Failed to load person"),o}finally{s(!1)}},createPerson:async r=>{s(!0),i();try{const a=await d.create(r);return t.value.unshift(a),l.value=a,a}catch(a){throw console.error("Error creating person:",a),v(a.response?.data?.message||"Failed to create person"),a}finally{s(!1)}},updatePerson:async(r,a)=>{s(!0),i();try{const e=await d.update(r,a),o=t.value.findIndex(p=>p.id===r);return o!==-1&&(t.value[o]=e),l.value?.id===r&&(l.value=e),e}catch(e){throw console.error("Error updating person:",e),v(e.response?.data?.message||"Failed to update person"),e}finally{s(!1)}},patchPerson:async(r,a)=>{s(!0),i();try{const e=await d.partialUpdate(r,a),o=t.value.findIndex(p=>p.id===r);return o!==-1&&(t.value[o]=e),l.value?.id===r&&(l.value=e),e}catch(e){throw console.error("Error updating person:",e),v(e.response?.data?.message||"Failed to update person"),e}finally{s(!1)}},deletePerson:async r=>{s(!0),i();try{return await d.delete(r),t.value=t.value.filter(a=>a.id!==r),l.value?.id===r&&(l.value=null),!0}catch(a){throw console.error("Error deleting person:",a),v(a.response?.data?.message||"Failed to delete person"),a}finally{s(!1)}},clearSelectedPerson:()=>{l.value=null},refreshCache:async()=>await E(!0),clearStore:()=>{t.value=[],l.value=null,u.value=null,n.value=!1,h.value=null,c.value={count:0,next:null,previous:null,currentPage:1,totalPages:1,hasMore:!1}}}});export{H as u};
