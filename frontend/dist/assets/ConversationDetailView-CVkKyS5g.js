import{Q as S}from"./QSpinnerDots-C2No3ue-.js";import{_ as E,d as T,c as U,J as j,e as M,f as $,w as l,M as R,C as H,o as n,b as e,a as c,u,h as t,i as d,t as i,j as m,m as f,n as x,L as k,l as p,k as _,F as J,p as K,K as O,q as G}from"./main-BUattiJr.js";import{Q as W,a as L}from"./QBreadcrumbs-Cw60VNnf.js";import{Q as P}from"./QChip-bPL42vie.js";import{f as X,u as Y,_ as Z,a as ee,Q as te,b as oe}from"./NavigationDrawer-CuUZiH8A.js";import{u as se,g as ae,a as le,b as ie}from"./conversations-BBteTRnd.js";import{a as Q,f as ne}from"./dateFormatting-FSBT3tMj.js";const re={key:0,class:"text-center q-pa-xl"},ce={key:1,class:"text-center q-pa-xl"},de={class:"text-h6 text-negative q-mt-md"},ue={key:2,class:"text-center q-pa-xl"},me={key:3,class:"conversation-detail-container"},ve={class:"breadcrumb-nav q-mb-md"},pe={class:"row items-start q-gutter-md"},_e={class:"col-auto"},ye={class:"col"},ge={class:"row items-center q-gutter-sm q-mb-sm"},fe={class:"text-h5 text-weight-medium"},xe={class:"text-body1 text-grey-8 q-mb-sm"},he={key:0},be={class:"text-body2 text-grey-6"},qe={key:0},we={class:"col-auto"},Ce={class:"action-buttons"},ke={class:"row q-col-gutter-lg"},Qe={class:"col-12 col-md-4"},De={class:"detail-item q-mb-md"},Ve={class:"row items-center q-gutter-sm"},ze={class:"col"},Be={class:"text-body1"},Te={class:"detail-item q-mb-md"},$e={class:"row items-center q-gutter-sm"},Le={class:"col"},Pe={class:"text-body1"},Fe={key:0,class:"detail-item q-mb-md"},Ne={class:"row items-center q-gutter-sm"},Ie={class:"col"},Ae={class:"text-body1"},Se={key:1,class:"detail-item"},Ee={class:"row items-center q-gutter-sm"},Ue=["onClick"],je={class:"col"},Me={class:"text-body2 text-weight-medium"},Re={key:0,class:"text-caption text-grey-6"},He={class:"col-12 col-md-8"},Je={class:"text-body1 text-grey-8 pre-line conversation-notes"},Ke={class:"q-ml-sm"},Oe={__name:"ConversationDetailView",setup(Ge){const D=R(),y=H(),V=Y(),v=se(),h=T(!1),g=T(!1),s=U(()=>v.selectedConversation),b=a=>!a||a.length===0?"Unknown":a.map(o=>o.name).join(", "),q=a=>le(a),z=a=>ie(a),w=a=>ae(a),C=async()=>{const a=D.params.id;if(a)try{await v.fetchConversationById(a)}catch(o){console.error("Failed to load conversation:",o)}},B=()=>{y.push({name:"conversations"})},F=()=>{s.value&&y.push({name:"conversation-edit",params:{id:s.value.id}})},N=()=>{if(s.value){const a=s.value.participants.map(o=>o.id);y.push({name:"conversation-create",query:{participants:a.join(","),followup:s.value.id}})}},I=a=>{y.push({name:"person-detail",params:{id:a.id}})},A=async()=>{if(s.value)try{const a=b(s.value.participants);await v.deleteConversation(s.value.id),g.value=!1,V.notify({type:"positive",message:`Conversation with ${a} deleted successfully`,position:"top",timeout:4e3,actions:[{icon:"close",color:"white",dense:!0}]}),y.push({name:"conversations"})}catch(a){console.error("Failed to delete conversation:",a),V.notify({type:"negative",message:"Failed to delete conversation. Please try again.",position:"top",timeout:4e3})}};return j(()=>D.params.id,(a,o)=>{a&&a!==o&&C()}),M(()=>{C()}),(a,o)=>(n(),$(X,{view:"lHh Lpr lFf"},{default:l(()=>[e(Z,{onToggleDrawer:o[0]||(o[0]=r=>h.value=!h.value)}),e(ee,{modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=r=>h.value=r)},null,8,["modelValue"]),e(te,null,{default:l(()=>[e(oe,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:l(()=>[u(v).isLoading?(n(),c("div",re,[e(S,{size:"50px",color:"primary"}),o[5]||(o[5]=t("div",{class:"q-mt-md"},"Loading conversation details...",-1))])):u(v).hasError?(n(),c("div",ce,[e(d,{name:"error_outline",size:"80px",color:"negative"}),t("div",de,i(u(v).error),1),e(m,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:C})])):s.value?(n(),c("div",me,[t("div",ve,[e(W,{class:"text-grey-6"},{default:l(()=>[e(L,{icon:"chat",label:"Conversations",onClick:B,class:"cursor-pointer"}),e(L,{label:`${b(s.value.participants)} - ${u(Q)(s.value.date)}`},null,8,["label"])]),_:1})]),e(f,{class:"header-card q-mb-lg",flat:""},{default:l(()=>[e(x,{class:"q-pa-lg"},{default:l(()=>[t("div",pe,[t("div",_e,[e(k,{size:"64px",color:w(s.value.type),"text-color":"white"},{default:l(()=>[e(d,{name:q(s.value.type),size:"32px"},null,8,["name"])]),_:1},8,["color"])]),t("div",ye,[t("div",ge,[t("div",fe,i(b(s.value.participants)),1),e(P,{color:w(s.value.type),"text-color":"white",icon:q(s.value.type)},{default:l(()=>[_(i(z(s.value.type)),1)]),_:1},8,["color","icon"]),s.value.private?(n(),$(P,{key:0,color:"orange","text-color":"white",icon:"lock"},{default:l(()=>[...o[7]||(o[7]=[_(" Private ",-1)])]),_:1})):p("",!0)]),t("div",xe,[_(i(u(Q)(s.value.date))+" ",1),s.value.location?(n(),c("span",he," â€¢ "+i(s.value.location),1)):p("",!0)]),t("div",be,[e(d,{name:"schedule",size:"16px",class:"q-mr-xs"}),_(" Added "+i(u(ne)(s.value.created_at))+" ",1),s.value.created_by_username?(n(),c("span",qe," by "+i(s.value.created_by_username),1)):p("",!0)])]),t("div",we,[t("div",Ce,[e(m,{outline:"",color:"primary",icon:"edit",label:"Edit",class:"q-mr-sm",onClick:F}),e(m,{outline:"",color:"positive",icon:"add_comment",label:"Follow-up",class:"q-mr-sm",onClick:N}),e(m,{outline:"",color:"negative",icon:"delete",label:"Delete",onClick:o[2]||(o[2]=r=>g.value=!0)})])])])]),_:1})]),_:1}),t("div",ke,[t("div",Qe,[e(f,{class:"content-card q-mb-lg",flat:"",bordered:""},{default:l(()=>[e(x,{class:"q-pa-lg"},{default:l(()=>[o[9]||(o[9]=t("div",{class:"text-h6 q-mb-md text-weight-medium"},"Details",-1)),t("div",De,[t("div",Ve,[e(d,{name:q(s.value.type),size:"20px",color:w(s.value.type)},null,8,["name","color"]),t("div",ze,[t("div",Be,i(z(s.value.type)),1)])])]),t("div",Te,[t("div",$e,[e(d,{name:"event",size:"20px",color:"grey-7"}),t("div",Le,[t("div",Pe,i(u(Q)(s.value.date)),1)])])]),s.value.location?(n(),c("div",Fe,[t("div",Ne,[e(d,{name:"place",size:"20px",color:"grey-7"}),t("div",Ie,[t("div",Ae,i(s.value.location),1)])])])):p("",!0),s.value.private?(n(),c("div",Se,[t("div",Ee,[e(d,{name:"lock",size:"20px",color:"orange"}),o[8]||(o[8]=t("div",{class:"col"},[t("div",{class:"text-body1"},"Private to you")],-1))])])):p("",!0)]),_:1})]),_:1}),e(f,{class:"content-card",flat:"",bordered:""},{default:l(()=>[e(x,{class:"q-pa-lg"},{default:l(()=>[o[10]||(o[10]=t("div",{class:"text-h6 q-mb-md text-weight-medium"},"Participants",-1)),(n(!0),c(J,null,K(s.value.participants,r=>(n(),c("div",{key:r.id,class:"participant-item"},[t("div",{class:"row items-center q-gutter-sm cursor-pointer",onClick:We=>I(r)},[e(k,{size:"32px",color:"grey-4","text-color":"grey-8"},{default:l(()=>[e(d,{name:"person"})]),_:1}),t("div",je,[t("div",Me,i(r.name),1),r.name_ext?(n(),c("div",Re,i(r.name_ext),1)):p("",!0)]),e(d,{name:"chevron_right",color:"grey-5"})],8,Ue)]))),128))]),_:1})]),_:1})]),t("div",He,[e(f,{class:"content-card",flat:"",bordered:""},{default:l(()=>[e(x,{class:"q-pa-lg"},{default:l(()=>[o[11]||(o[11]=t("div",{class:"text-h6 q-mb-md text-weight-medium"},"Notes",-1)),t("div",Je,i(s.value.notes),1)]),_:1})]),_:1})])])])):(n(),c("div",ue,[e(d,{name:"chat_bubble_outline",size:"80px",color:"grey-5"}),o[6]||(o[6]=t("div",{class:"text-h6 text-grey-7 q-mt-md"}," Conversation not found ",-1)),e(m,{color:"primary",label:"Back to Conversations",class:"q-mt-md",onClick:B})])),e(O,{modelValue:g.value,"onUpdate:modelValue":o[4]||(o[4]=r=>g.value=r)},{default:l(()=>[e(f,null,{default:l(()=>[e(x,{class:"row items-center"},{default:l(()=>[e(k,{icon:"warning",color:"negative","text-color":"white"}),t("span",Ke,[o[12]||(o[12]=_(" Are you sure you want to delete this conversation with ",-1)),t("strong",null,i(s.value?b(s.value.participants):""),1),o[13]||(o[13]=_("? This action cannot be undone. ",-1))])]),_:1}),e(G,{align:"right"},{default:l(()=>[e(m,{flat:"",label:"Cancel",color:"primary",onClick:o[3]||(o[3]=r=>g.value=!1)}),e(m,{flat:"",label:"Delete",color:"negative",onClick:A})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},at=E(Oe,[["__scopeId","data-v-3f016a53"]]);export{at as default};
