import{_ as Y,d as w,c as Z,e as J,f as v,w as s,C as K,o as n,b as a,h as l,a as i,j as h,D as W,i as c,u as k,t as d,l as Q,F as X,p as ee,m as te,n as oe,L as ae,k as f,G as se,N as q,O as le}from"./main-BUattiJr.js";import{Q as z,a as ne}from"./QSelect-D_7hzanl.js";import{Q as re}from"./QSpinnerDots-C2No3ue-.js";import{Q as I}from"./QChip-bPL42vie.js";import{f as ie,u as ce,_ as de,a as ue,Q as pe,b as me,c as ve,d as V,e as y}from"./NavigationDrawer-CuUZiH8A.js";import{C as T}from"./ClosePopup-Ddft_vXm.js";import{u as fe,b as D,c as ye,g as _e,a as Ce}from"./conversations-BBteTRnd.js";import{f as ge}from"./dateFormatting-FSBT3tMj.js";import"./QItemLabel-C8FJA7k9.js";const we={class:"row items-center q-mb-lg"},he={class:"row q-col-gutter-md q-mb-lg"},ke={class:"col-12 col-md-6"},be={class:"col-12 col-md-3"},xe={class:"col-12 col-md-3"},Qe={key:0,class:"text-center q-pa-lg"},qe={key:1,class:"text-center q-pa-xl"},Ve={class:"text-h6 text-negative q-mt-md"},Te={key:2,class:"text-center q-pa-xl"},De={class:"text-h6 text-grey-7 q-mt-md"},Le={key:3,class:"row q-col-gutter-md"},Fe={class:"row items-start q-gutter-md"},Se={class:"col-auto"},Ne={class:"col"},$e={class:"row items-center q-gutter-sm q-mb-xs"},ze={class:"text-h6"},Ie={class:"text-body2 text-grey-8 q-mb-sm"},Ae={key:0},Pe={class:"text-body2 text-grey-7 conversation-notes"},Be={class:"col-auto"},Oe={__name:"ConversationsView",setup(Ue){const C=K(),b=ce(),u=fe(),g=w(!1),p=w(""),m=w(""),x=w("-date"),A=[...ye,{label:"All Types",value:""}],P=[{label:"Most Recent",value:"-date"},{label:"Oldest First",value:"date"},{label:"Type",value:"type"},{label:"Participants (A-Z)",value:"participants"}],L=Z(()=>{let o=[...u.getConversationsList];if(p.value){const e=p.value.toLowerCase().trim();o=o.filter(t=>{const r=_(t.participants).toLowerCase(),G=t.notes.toLowerCase(),H=t.location?.toLowerCase()||"";return r.includes(e)||G.includes(e)||H.includes(e)})}return m.value&&(o=o.filter(e=>e.type===m.value)),o.sort((e,t)=>{switch(x.value){case"date":return new Date(e.date)-new Date(t.date);case"-date":return new Date(t.date)-new Date(e.date);case"type":return D(e.type).localeCompare(D(t.type));case"participants":return _(e.participants).localeCompare(_(t.participants));default:return 0}}),o}),_=o=>!o||o.length===0?"Unknown":o.map(e=>e.name).join(", "),F=o=>Ce(o),B=o=>D(o),S=o=>_e(o),O=(o,e)=>!o||o.length<=e?o:o.substring(0,e).trim()+"...",N=async()=>{try{await u.fetchConversations()}catch(o){console.error("Error loading conversations:",o)}},U=o=>{C.push({name:"conversation-detail",params:{id:o.id}})},$=()=>{C.push({name:"conversation-create"})},M=o=>{C.push({name:"conversation-edit",params:{id:o.id}})},E=o=>{const e=o.participants.map(t=>t.id);C.push({name:"conversation-create",query:{participants:e.join(","),followup:o.id}})},j=async o=>{b.dialog({title:"Delete Conversation",message:`Are you sure you want to delete this conversation with ${_(o.participants)}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await u.deleteConversation(o.id),b.notify({type:"positive",message:"Conversation deleted successfully",position:"top",timeout:3e3})}catch(e){console.error("Failed to delete conversation:",e),b.notify({type:"negative",message:"Failed to delete conversation. Please try again.",position:"top",timeout:4e3})}})},R=(o,e)=>{};return J(()=>{N()}),(o,e)=>(n(),v(ie,{view:"lHh Lpr lFf"},{default:s(()=>[a(de,{onToggleDrawer:e[0]||(e[0]=t=>g.value=!g.value)}),a(ue,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t)},null,8,["modelValue"]),a(pe,null,{default:s(()=>[a(me,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[l("div",we,[e[5]||(e[5]=l("div",{class:"text-h4 col"},"Conversations",-1)),a(h,{color:"primary",icon:"add",label:"Add Conversation",onClick:$})]),l("div",he,[l("div",ke,[a(W,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),filled:"",placeholder:"Search conversations...",clearable:""},{prepend:s(()=>[a(c,{name:"search"})]),_:1},8,["modelValue"])]),l("div",be,[a(z,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=t=>m.value=t),filled:"",options:A,label:"Filter by type","emit-value":"","map-options":"",clearable:""},null,8,["modelValue"])]),l("div",xe,[a(z,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=t=>x.value=t),filled:"",options:P,label:"Sort by","emit-value":"","map-options":""},null,8,["modelValue"])])]),k(u).isLoading?(n(),i("div",Qe,[a(re,{size:"50px",color:"primary"}),e[6]||(e[6]=l("div",{class:"q-mt-md"},"Loading conversations...",-1))])):k(u).hasError?(n(),i("div",qe,[a(c,{name:"error_outline",size:"80px",color:"negative"}),l("div",Ve,d(k(u).error),1),a(h,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:N})])):L.value.length===0?(n(),i("div",Te,[a(c,{name:"chat_bubble_outline",size:"80px",color:"grey-5"}),l("div",De,d(p.value||m.value?"No conversations found matching your criteria":"No conversations recorded yet"),1),!p.value&&!m.value?(n(),v(h,{key:0,color:"primary",label:"Add Your First Conversation",class:"q-mt-md",onClick:$})):Q("",!0)])):(n(),i("div",Le,[(n(!0),i(X,null,ee(L.value,t=>(n(),i("div",{key:t.id,class:"col-12"},[a(te,{class:"conversation-card cursor-pointer",onClick:r=>U(t)},{default:s(()=>[a(oe,null,{default:s(()=>[l("div",Fe,[l("div",Se,[a(ae,{size:"48px",color:S(t.type),"text-color":"white"},{default:s(()=>[a(c,{name:F(t.type),size:"24px"},null,8,["name"])]),_:2},1032,["color"])]),l("div",Ne,[l("div",$e,[l("div",ze,d(_(t.participants)),1),a(I,{size:"sm",color:S(t.type),"text-color":"white",icon:F(t.type)},{default:s(()=>[f(d(B(t.type)),1)]),_:2},1032,["color","icon"]),t.private?(n(),v(I,{key:0,size:"sm",color:"orange","text-color":"white",icon:"lock"},{default:s(()=>[...e[7]||(e[7]=[f(" Private ",-1)])]),_:1})):Q("",!0)]),l("div",Ie,[f(d(k(ge)(t.date))+" ",1),t.location?(n(),i("span",Ae," â€¢ "+d(t.location),1)):Q("",!0)]),l("div",Pe,d(O(t.notes,150)),1)]),l("div",Be,[a(h,{flat:"",round:"",size:"sm",icon:"more_vert",onClick:se(r=>R(r,t),["stop"])},{default:s(()=>[a(ne,null,{default:s(()=>[a(ve,{style:{"min-width":"100px"}},{default:s(()=>[q((n(),v(V,{clickable:"",onClick:r=>M(t)},{default:s(()=>[a(y,{avatar:""},{default:s(()=>[a(c,{name:"edit"})]),_:1}),a(y,null,{default:s(()=>[...e[8]||(e[8]=[f("Edit",-1)])]),_:1})]),_:2},1032,["onClick"])),[[T]]),q((n(),v(V,{clickable:"",onClick:r=>E(t)},{default:s(()=>[a(y,{avatar:""},{default:s(()=>[a(c,{name:"add_comment"})]),_:1}),a(y,null,{default:s(()=>[...e[9]||(e[9]=[f("Follow-up",-1)])]),_:1})]),_:2},1032,["onClick"])),[[T]]),a(le),q((n(),v(V,{clickable:"",onClick:r=>j(t)},{default:s(()=>[a(y,{avatar:""},{default:s(()=>[a(c,{name:"delete",color:"negative"})]),_:1}),a(y,{class:"text-negative"},{default:s(()=>[...e[10]||(e[10]=[f("Delete",-1)])]),_:1})]),_:2},1032,["onClick"])),[[T]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]))]),_:1})]),_:1})]),_:1}))}},Ke=Y(Oe,[["__scopeId","data-v-79cc3903"]]);export{Ke as default};
