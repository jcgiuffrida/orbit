import{_ as H,d as h,c as Z,e as J,f as v,w as s,B as K,o as l,b as a,h as n,a as c,j as k,C as W,i as d,D as Q,t as f,n as x,F as X,p as ee,L as te,l as oe,m as ae,k as y,G as se,a1 as q,a2 as ne}from"./main-dX18QWmU.js";import{Q as M,e as le}from"./QSelect-DtYhIMXs.js";import{Q as re}from"./QSpinnerDots-CAPuhkqD.js";import{Q as B}from"./QChip-CUDH5aZX.js";import{f as ie,u as ce,_ as de,a as ue,Q as me,b as pe,c as ve,d as V,e as _}from"./NavigationDrawer-BnBvVe_K.js";import{C as D}from"./ClosePopup-CU_PJYYY.js";import{u as fe,g as T,c as ye,a as _e}from"./contactAttempts-V-aEN0Pq.js";import"./QItemLabel-DxnQzhsc.js";const ge={class:"row items-center q-mb-lg"},Ce={class:"row q-col-gutter-md q-mb-lg"},we={class:"col-12 col-md-6"},he={class:"col-12 col-md-3"},ke={class:"col-12 col-md-3"},xe={key:0,class:"text-center q-pa-lg"},be={key:1,class:"text-center q-pa-xl"},Ae={class:"text-h6 text-negative q-mt-md"},Qe={key:2,class:"text-center q-pa-xl"},qe={class:"text-h6 text-grey-7 q-mt-md"},Ve={key:3,class:"timeline-container"},De={class:"timeline-marker"},Te={class:"row items-start justify-between"},Le={class:"col"},$e={class:"row items-center q-gutter-sm q-mb-sm"},Se={class:"text-h6 text-weight-medium"},ze={class:"text-body2 text-grey-8 q-mb-sm"},Fe={key:0,class:"text-body2 text-grey-7"},Me={key:1,class:"text-caption text-positive q-mt-sm"},Be={class:"col-auto"},Ie={__name:"ContactAttemptsView",setup(Ne){const C=K(),b=ce(),u=fe(),w=h(!1),m=h(""),p=h(""),A=h("-date"),I=[...ye,{label:"All Types",value:""}],N=[{label:"Most Recent",value:"-date"},{label:"Oldest First",value:"date"},{label:"Type",value:"type"},{label:"Person (A-Z)",value:"person_name"}],L=Z(()=>{let o=[...u.getContactAttemptsList];if(m.value){const e=m.value.toLowerCase().trim();o=o.filter(t=>{const i=(t.person_name||"").toLowerCase(),r=(t.notes||"").toLowerCase();return i.includes(e)||r.includes(e)})}return p.value&&(o=o.filter(e=>e.type===p.value)),o.sort((e,t)=>{switch(A.value){case"date":return new Date(e.date)-new Date(t.date);case"-date":return new Date(t.date)-new Date(e.date);case"type":return T(e.type).localeCompare(T(t.type));case"person_name":return(e.person_name||"").localeCompare(t.person_name||"");default:return 0}}),o}),$=o=>_e(o),P=o=>T(o),S=o=>({text:"info",email:"secondary",call:"positive",social:"accent",other:"grey-6"})[o]||"grey-6",O=o=>{if(!o)return"";const e=new Date(o),i=new Date-e,r=Math.floor(i/(1e3*60*60*24));if(r===0)return"Today";if(r===1)return"Yesterday";if(r<7)return`${r} days ago`;if(r<30){const g=Math.floor(r/7);return g===1?"1 week ago":`${g} weeks ago`}if(r<365){const g=Math.floor(r/30);return g===1?"1 month ago":`${g} months ago`}return e.toLocaleDateString()},U=(o,e)=>!o||o.length<=e?o:o.substring(0,e).trim()+"...",z=async()=>{try{await u.fetchContactAttempts()}catch(o){console.error("Error loading contact attempts:",o)}},E=o=>{C.push({name:"contact-attempt-detail",params:{id:o.id}})},F=()=>{C.push({name:"contact-attempt-create"})},j=o=>{C.push({name:"contact-attempt-edit",params:{id:o.id}})},R=o=>{C.push({name:"conversation-create",query:{participants:o.person,from_attempt:o.id}})},Y=async o=>{b.dialog({title:"Delete Contact Attempt",message:`Are you sure you want to delete this contact attempt with ${o.person_name}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await u.deleteContactAttempt(o.id),b.notify({type:"negative",message:"Contact attempt deleted successfully",position:"top",timeout:3e3})}catch(e){console.error("Failed to delete contact attempt:",e),b.notify({type:"negative",message:"Failed to delete contact attempt. Please try again.",position:"top",timeout:4e3})}})},G=(o,e)=>{};return J(()=>{z()}),(o,e)=>(l(),v(ie,{view:"lHh Lpr lFf"},{default:s(()=>[a(de,{onToggleDrawer:e[0]||(e[0]=t=>w.value=!w.value)}),a(ue,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t)},null,8,["modelValue"]),a(me,null,{default:s(()=>[a(pe,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[n("div",ge,[e[5]||(e[5]=n("div",{class:"text-h4 col"},"Contact Attempts",-1)),a(k,{color:"primary",icon:"add",label:"Add Contact Attempt",onClick:F})]),n("div",Ce,[n("div",we,[a(W,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value=t),filled:"",placeholder:"Search contact attempts...",clearable:""},{prepend:s(()=>[a(d,{name:"search"})]),_:1},8,["modelValue"])]),n("div",he,[a(M,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=t=>p.value=t),filled:"",options:I,label:"Filter by type","emit-value":"","map-options":"",clearable:""},null,8,["modelValue"])]),n("div",ke,[a(M,{modelValue:A.value,"onUpdate:modelValue":e[4]||(e[4]=t=>A.value=t),filled:"",options:N,label:"Sort by","emit-value":"","map-options":""},null,8,["modelValue"])])]),Q(u).isLoading?(l(),c("div",xe,[a(re,{size:"50px",color:"primary"}),e[6]||(e[6]=n("div",{class:"q-mt-md"},"Loading contact attempts...",-1))])):Q(u).hasError?(l(),c("div",be,[a(d,{name:"error_outline",size:"80px",color:"negative"}),n("div",Ae,f(Q(u).error),1),a(k,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:z})])):L.value.length===0?(l(),c("div",Qe,[a(d,{name:"contact_phone",size:"80px",color:"grey-5"}),n("div",qe,f(m.value||p.value?"No contact attempts found matching your criteria":"No contact attempts recorded yet"),1),!m.value&&!p.value?(l(),v(k,{key:0,color:"primary",label:"Add Your First Contact Attempt",class:"q-mt-md",onClick:F})):x("",!0)])):(l(),c("div",Ve,[(l(!0),c(X,null,ee(L.value,t=>(l(),c("div",{key:t.id,class:"timeline-item q-mb-md"},[n("div",De,[a(te,{size:"40px",color:S(t.type),"text-color":"white"},{default:s(()=>[a(d,{name:$(t.type),size:"20px"},null,8,["name"])]),_:2},1032,["color"])]),a(oe,{class:"timeline-card cursor-pointer",onClick:i=>E(t)},{default:s(()=>[a(ae,null,{default:s(()=>[n("div",Te,[n("div",Le,[n("div",$e,[n("div",Se,f(t.person_name||"Unknown Person"),1),a(B,{size:"sm",color:S(t.type),"text-color":"white",icon:$(t.type)},{default:s(()=>[y(f(P(t.type)),1)]),_:2},1032,["color","icon"]),t.private?(l(),v(B,{key:0,size:"sm",color:"orange","text-color":"white",icon:"lock"},{default:s(()=>[...e[7]||(e[7]=[y(" Private ",-1)])]),_:1})):x("",!0)]),n("div",ze,f(O(t.date)),1),t.notes?(l(),c("div",Fe,f(U(t.notes,150)),1)):x("",!0),t.led_to_conversation?(l(),c("div",Me,[a(d,{name:"arrow_forward",size:"14px",class:"q-mr-xs"}),e[8]||(e[8]=y(" Led to conversation ",-1))])):x("",!0)]),n("div",Be,[a(k,{flat:"",round:"",size:"sm",icon:"more_vert",onClick:se(i=>G(i,t),["stop"])},{default:s(()=>[a(le,null,{default:s(()=>[a(ve,{style:{"min-width":"100px"}},{default:s(()=>[q((l(),v(V,{clickable:"",onClick:i=>j(t)},{default:s(()=>[a(_,{avatar:""},{default:s(()=>[a(d,{name:"edit"})]),_:1}),a(_,null,{default:s(()=>[...e[9]||(e[9]=[y("Edit",-1)])]),_:1})]),_:2},1032,["onClick"])),[[D]]),q((l(),v(V,{clickable:"",onClick:i=>R(t)},{default:s(()=>[a(_,{avatar:""},{default:s(()=>[a(d,{name:"chat_bubble"})]),_:1}),a(_,null,{default:s(()=>[...e[10]||(e[10]=[y("Add Conversation",-1)])]),_:1})]),_:2},1032,["onClick"])),[[D]]),a(ne),q((l(),v(V,{clickable:"",onClick:i=>Y(t)},{default:s(()=>[a(_,{avatar:""},{default:s(()=>[a(d,{name:"delete",color:"negative"})]),_:1}),a(_,{class:"text-negative"},{default:s(()=>[...e[11]||(e[11]=[y("Delete",-1)])]),_:1})]),_:2},1032,["onClick"])),[[D]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]))]),_:1})]),_:1})]),_:1}))}},He=H(Ie,[["__scopeId","data-v-91c7c1d6"]]);export{He as default};
