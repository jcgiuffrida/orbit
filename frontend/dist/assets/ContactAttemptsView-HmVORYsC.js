import{_ as j,d as C,c as G,e as H,f,w as a,D as Y,o as n,b as o,h as l,a as r,j as k,E as Z,i,u as y,t as m,l as w,F as J,p as K,L as W,m as X,n as ee,k as c,G as te,N as A,O as oe}from"./main-BNYyCrAV.js";import{Q as z,a as se}from"./QSelect-D7AnBUJS.js";import{Q as ae,a as $}from"./QSpinnerDots-DKX6m9Q8.js";import{Q as le}from"./QTooltip-DaHthXlo.js";import{f as ne,u as re,_ as ie,a as ce,Q as de,b as ue,c as me,d as Q,e as _}from"./NavigationDrawer-CoZBpgI1.js";import{C as q}from"./ClosePopup-DeKXS_Ub.js";import{u as pe,g as V,c as ve,a as fe,b as _e}from"./contactAttempts-DvSW2dkB.js";import{a as ye,f as ge}from"./dateFormatting-Bb5cIjpU.js";import"./QItemLabel-Co7gJjbr.js";import"./position-engine--pu8bc_Q.js";const Ce={class:"row items-center q-mb-lg"},ke={class:"row q-col-gutter-md q-mb-lg"},we={class:"col-12 col-md-6"},xe={class:"col-12 col-md-3"},he={class:"col-12 col-md-3"},be={key:0,class:"text-center q-pa-lg"},Ae={key:1,class:"text-center q-pa-xl"},Qe={class:"text-h6 text-negative q-mt-md"},qe={key:2,class:"text-center q-pa-xl"},Ve={class:"text-h6 text-grey-7 q-mt-md"},Te={key:3,class:"timeline-container"},De={class:"timeline-marker"},Le={class:"row items-start justify-between"},Pe={class:"col"},Fe={class:"row items-center q-gutter-sm q-mb-sm"},Se={class:"text-h6 text-weight-medium"},ze={class:"text-body2 text-grey-8 q-mb-sm"},$e={key:0,class:"text-body2 text-grey-7"},Ne={key:1,class:"text-caption text-positive q-mt-sm"},Ie={class:"col-auto"},Be={__name:"ContactAttemptsView",setup(Oe){const x=Y(),h=re(),d=pe(),g=C(!1),p=C(""),v=C(""),b=C("-date"),N=[...ve,{label:"All Types",value:""}],I=[{label:"Most Recent",value:"-date"},{label:"Oldest First",value:"date"},{label:"Type",value:"type"},{label:"Person (A-Z)",value:"person_name"}],T=G(()=>{let s=[...d.getContactAttemptsList];if(p.value){const e=p.value.toLowerCase().trim();s=s.filter(t=>{const u=(t.person_name||"").toLowerCase(),R=(t.notes||"").toLowerCase();return u.includes(e)||R.includes(e)})}return v.value&&(s=s.filter(e=>e.type===v.value)),s.sort((e,t)=>{switch(b.value){case"date":return new Date(e.date)-new Date(t.date);case"-date":return new Date(t.date)-new Date(e.date);case"type":return V(e.type).localeCompare(V(t.type));case"person_name":return(e.person_name||"").localeCompare(t.person_name||"");default:return 0}}),s}),D=s=>_e(s),B=s=>V(s),L=s=>fe(s),O=(s,e)=>!s||s.length<=e?s:s.substring(0,e).trim()+"...",P=async()=>{try{const s=d.contactAttemptsCount<=1;await d.fetchContactAttempts(s)}catch(s){console.error("Error loading contact attempts:",s)}},F=()=>{x.push({name:"ping-create"})},S=s=>{x.push({name:"ping-edit",params:{id:s.id}})},E=s=>{x.push({name:"conversation-create",query:{participants:s.person,from_attempt:s.id}})},M=async s=>{h.dialog({title:"Delete Ping",message:`Are you sure you want to delete this ping with ${s.person_name}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await d.deleteContactAttempt(s.id),h.notify({type:"positive",message:"Ping deleted successfully",position:"top",timeout:3e3})}catch(e){console.error("Failed to delete ping:",e),h.notify({type:"negative",message:"Failed to delete ping. Please try again.",position:"top",timeout:4e3})}})},U=(s,e)=>{};return H(()=>{P()}),(s,e)=>(n(),f(ne,{view:"lHh Lpr lFf"},{default:a(()=>[o(ie,{onToggleDrawer:e[0]||(e[0]=t=>g.value=!g.value)}),o(ce,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t)},null,8,["modelValue"]),o(de,null,{default:a(()=>[o(ue,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:a(()=>[l("div",Ce,[e[5]||(e[5]=l("div",{class:"col"},[l("div",{class:"text-h4"},"Pings"),l("div",{class:"text-subtitle1 text-grey-7"},"Pings are contact attempts, like emails or text messages, that try to lead to conversations.")],-1)),o(k,{color:"primary",icon:"add",label:"Add Ping",onClick:F})]),l("div",ke,[l("div",we,[o(Z,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),filled:"",placeholder:"Search pings...",clearable:""},{prepend:a(()=>[o(i,{name:"search"})]),_:1},8,["modelValue"])]),l("div",xe,[o(z,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),filled:"",options:N,label:"Filter by type","emit-value":"","map-options":"",clearable:""},null,8,["modelValue"])]),l("div",he,[o(z,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),filled:"",options:I,label:"Sort by","emit-value":"","map-options":""},null,8,["modelValue"])])]),y(d).isLoading?(n(),r("div",be,[o(ae,{size:"50px",color:"primary"}),e[6]||(e[6]=l("div",{class:"q-mt-md"},"Loading pings...",-1))])):y(d).hasError?(n(),r("div",Ae,[o(i,{name:"error_outline",size:"80px",color:"negative"}),l("div",Qe,m(y(d).error),1),o(k,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:P})])):T.value.length===0?(n(),r("div",qe,[o(i,{name:"contact_phone",size:"80px",color:"grey-5"}),l("div",Ve,m(p.value||v.value?"No pings found matching your criteria":"No pings recorded yet"),1),!p.value&&!v.value?(n(),f(k,{key:0,color:"primary",label:"Add Your First Ping",class:"q-mt-md",onClick:F})):w("",!0)])):(n(),r("div",Te,[(n(!0),r(J,null,K(T.value,t=>(n(),r("div",{key:t.id,class:"timeline-item q-mb-md"},[l("div",De,[o(W,{size:"40px",color:L(t.type),"text-color":"white"},{default:a(()=>[o(i,{name:D(t.type),size:"20px"},null,8,["name"])]),_:2},1032,["color"])]),o(X,{class:"timeline-card cursor-pointer",onClick:u=>S(t)},{default:a(()=>[o(ee,null,{default:a(()=>[l("div",Le,[l("div",Pe,[l("div",Fe,[l("div",Se,m(t.person_name||"Unknown Person"),1),o($,{size:"sm",color:L(t.type),"text-color":"white",icon:D(t.type)},{default:a(()=>[c(m(B(t.type)),1)]),_:2},1032,["color","icon"]),t.private?(n(),f($,{key:0,size:"sm",color:"orange","text-color":"white",icon:"lock"},{default:a(()=>[...e[7]||(e[7]=[c(" Private ",-1)])]),_:1})):w("",!0)]),l("div",ze,[c(m(y(ye)(t.date))+" ",1),o(le,null,{default:a(()=>[c(m(y(ge)(t.date)),1)]),_:2},1024)]),t.notes?(n(),r("div",$e,m(O(t.notes,150)),1)):w("",!0),t.led_to_conversation?(n(),r("div",Ne,[o(i,{name:"arrow_forward",size:"14px",class:"q-mr-xs"}),e[8]||(e[8]=c(" Led to conversation ",-1))])):w("",!0)]),l("div",Ie,[o(k,{flat:"",round:"",size:"sm",icon:"more_vert",onClick:te(u=>U(u,t),["stop"])},{default:a(()=>[o(se,null,{default:a(()=>[o(me,{style:{"min-width":"100px"}},{default:a(()=>[A((n(),f(Q,{clickable:"",onClick:u=>S(t)},{default:a(()=>[o(_,{avatar:""},{default:a(()=>[o(i,{name:"edit"})]),_:1}),o(_,null,{default:a(()=>[...e[9]||(e[9]=[c("Edit",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]]),A((n(),f(Q,{clickable:"",onClick:u=>E(t)},{default:a(()=>[o(_,{avatar:""},{default:a(()=>[o(i,{name:"chat_bubble"})]),_:1}),o(_,null,{default:a(()=>[...e[10]||(e[10]=[c("Add Conversation",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]]),o(oe),A((n(),f(Q,{clickable:"",onClick:u=>M(t)},{default:a(()=>[o(_,{avatar:""},{default:a(()=>[o(i,{name:"delete",color:"negative"})]),_:1}),o(_,{class:"text-negative"},{default:a(()=>[...e[11]||(e[11]=[c("Delete",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]))]),_:1})]),_:1})]),_:1}))}},Ke=j(Be,[["__scopeId","data-v-a3fcf31a"]]);export{Ke as default};
