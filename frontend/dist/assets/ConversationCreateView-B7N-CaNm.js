import{Q as H}from"./QSpinnerDots-CAPuhkqD.js";import{_ as W,d as c,c as F,H as J,I as K,J as M,e as G,f as y,w as l,B as X,o as u,b as a,a as w,h as i,t as m,i as h,j as k,n as P,l as S,m as D,k as L,C as I,D as Y,a3 as Z,a4 as ee,a5 as ae}from"./main-dX18QWmU.js";import{Q as te,a as B}from"./QBreadcrumbs-Bx5Ld7_t.js";import{Q as oe}from"./QChip-CUDH5aZX.js";import{Q as U}from"./QSelect-DtYhIMXs.js";import{f as le,u as se,_ as ne,a as ie,Q as re,b as ue,d as de,e as b}from"./NavigationDrawer-BnBvVe_K.js";import{Q as N}from"./QItemLabel-DxnQzhsc.js";import{Q as pe}from"./QForm-BpANVRpW.js";import{u as ce,c as me}from"./conversations-Bg2_r2g9.js";import{u as ve}from"./people-DVvTElOy.js";const fe={key:0,class:"text-center q-pa-xl"},ye={class:"q-mt-md"},be={key:1,class:"text-center q-pa-xl"},ge={class:"text-h6 text-negative q-mt-md"},Ce={key:2},_e={class:"breadcrumb-nav q-mb-md"},qe={class:"row justify-center"},xe={class:"col-12 col-md-10 col-lg-8"},Ve={class:"row q-gutter-sm justify-end q-mt-lg"},Qe={__name:"ConversationCreateView",setup(we){const d=J(),p=X(),g=se(),v=ce(),C=ve(),f=c(!1),_=c(!1),q=c(!1),x=c(!1),V=c(null),n=c(null),r=F(()=>d.params.id&&d.params.id!=="new"),o=K({participants:[],date:new Date().toISOString().split("T")[0],type:"",location:"",notes:"",private:!1}),$=F(()=>C.getPeopleList),T=s=>{_.value=s,s&&(x.value=!1,V.value=null)},A=s=>{x.value=!0,V.value=s,_.value=!1},E=async()=>{if(C.getPeopleList.length===0)try{await C.fetchPeople()}catch(s){console.error("Failed to load people:",s)}},Q=async()=>{T(!0);try{if(await E(),r.value){const s=d.params.id;await v.fetchConversationById(s),n.value=v.selectedConversation,n.value&&(o.participants=n.value.participants.map(t=>t.id),o.date=n.value.date,o.type=n.value.type,o.location=n.value.location||"",o.notes=n.value.notes||"",o.private=n.value.private||!1)}else d.query.participants&&(o.participants=d.query.participants.split(","))}catch(s){console.error("Failed to load data:",s),A("Failed to load data")}finally{T(!1)}},R=async()=>{q.value=!0;try{const s={participant_ids:o.participants,date:o.date,type:o.type,location:o.location||"",notes:o.notes,private:o.private};if(r.value){const t=await v.updateConversation(n.value.id,s);g.notify({type:"positive",message:"Conversation updated successfully",position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),p.push({name:"conversation-detail",params:{id:t.id}})}else{const t=await v.createConversation(s);g.notify({type:"positive",message:"Conversation added successfully",position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),p.push({name:"conversation-detail",params:{id:t.id}})}}catch(s){console.error("Failed to save conversation:",s),g.notify({type:"negative",message:`Failed to ${r.value?"update":"create"} conversation. Please try again.`,position:"top",timeout:4e3})}finally{q.value=!1}},j=()=>{r.value&&n.value?p.push({name:"conversation-detail",params:{id:n.value.id}}):p.push({name:"conversations"})},z=()=>{p.push({name:"conversations"})},O=()=>{r.value&&n.value&&p.push({name:"conversation-detail",params:{id:n.value.id}})};return M(()=>d.params.id,(s,t)=>{s&&s!==t&&Q()}),G(()=>{Q()}),(s,t)=>(u(),y(le,{view:"lHh Lpr lFf"},{default:l(()=>[a(ne,{onToggleDrawer:t[0]||(t[0]=e=>f.value=!f.value)}),a(ie,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e)},null,8,["modelValue"]),a(re,null,{default:l(()=>[a(ue,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:l(()=>[_.value?(u(),w("div",fe,[a(H,{size:"50px",color:"primary"}),i("div",ye,m(r.value?"Loading conversation details...":"Loading..."),1)])):x.value?(u(),w("div",be,[a(h,{name:"error_outline",size:"80px",color:"negative"}),i("div",ge,m(V.value),1),a(k,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:Q})])):(u(),w("div",Ce,[i("div",_e,[a(te,{class:"text-grey-6"},{default:l(()=>[a(B,{icon:"chat",label:"Conversations",onClick:z,class:"cursor-pointer"}),r.value?(u(),y(B,{key:0,label:n.value?.participants?.map(e=>e.name).join(", ")||"Conversation",onClick:O,class:"cursor-pointer"},null,8,["label"])):P("",!0),a(B,{label:r.value?"Edit":"Add Conversation"},null,8,["label"])]),_:1})]),i("div",qe,[i("div",xe,[a(pe,{onSubmit:R,class:"q-gutter-md",autocomplete:"off"},{default:l(()=>[a(S,null,{default:l(()=>[a(D,null,{default:l(()=>[t[8]||(t[8]=i("div",{class:"text-h6 q-mb-md"},"Conversation Details",-1)),a(U,{modelValue:o.participants,"onUpdate:modelValue":t[2]||(t[2]=e=>o.participants=e),options:$.value,label:"Participants *",filled:"",multiple:"",required:"","option-value":"id","option-label":"name","emit-value":"","map-options":"","use-chips":"","stack-label":"",autocomplete:"off",class:"q-mb-md",rules:[e=>e&&e.length>0||"At least one participant is required"],onPopupShow:E},{"selected-item":l(e=>[a(oe,{removable:"",onRemove:he=>e.removeAtIndex(e.index),tabindex:e.tabindex,class:"q-ma-xs"},{default:l(()=>[L(m(e.opt.name),1)]),_:2},1032,["onRemove","tabindex"])]),_:1},8,["modelValue","options","rules"]),a(I,{modelValue:o.date,"onUpdate:modelValue":t[3]||(t[3]=e=>o.date=e),label:"Date *",type:"date",filled:"",required:"",autocomplete:"off",class:"q-mb-md",rules:[e=>!!e||"Date is required"]},null,8,["modelValue","rules"]),a(U,{modelValue:o.type,"onUpdate:modelValue":t[4]||(t[4]=e=>o.type=e),options:Y(me),label:"Conversation Type *",filled:"",required:"","option-value":"value","option-label":"label","emit-value":"","map-options":"",autocomplete:"off",class:"q-mb-md",rules:[e=>!!e||"Conversation type is required"]},{"selected-item":l(e=>[e.opt.icon?(u(),y(b,{key:0,avatar:""},{default:l(()=>[a(h,{name:e.opt.icon},null,8,["name"])]),_:2},1024)):P("",!0),a(b,null,{default:l(()=>[a(N,null,{default:l(()=>[L(m(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),option:l(e=>[a(de,Z(ee(e.itemProps)),{default:l(()=>[e.opt.icon?(u(),y(b,{key:0,avatar:""},{default:l(()=>[a(h,{name:e.opt.icon},null,8,["name"])]),_:2},1024)):P("",!0),a(b,null,{default:l(()=>[a(N,null,{default:l(()=>[L(m(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"]),a(I,{modelValue:o.location,"onUpdate:modelValue":t[5]||(t[5]=e=>o.location=e),label:"Location",hint:"Where did this conversation take place?",filled:"",autocomplete:"off",class:"q-mb-md"},null,8,["modelValue"])]),_:1})]),_:1}),a(S,null,{default:l(()=>[a(D,null,{default:l(()=>[t[9]||(t[9]=i("div",{class:"text-h6 q-mb-md"},"Notes",-1)),a(I,{modelValue:o.notes,"onUpdate:modelValue":t[6]||(t[6]=e=>o.notes=e),label:"Conversation notes *",type:"textarea",rows:"6",filled:"",required:"",autocomplete:"off",hint:"What was discussed? Key topics, outcomes, follow-ups needed, etc.",class:"q-mb-md",rules:[e=>!!e||"Notes are required"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(S,null,{default:l(()=>[a(D,null,{default:l(()=>[t[10]||(t[10]=i("div",{class:"text-h6 q-mb-md"},"Privacy Settings",-1)),a(ae,{modelValue:o.private,"onUpdate:modelValue":t[7]||(t[7]=e=>o.private=e),label:"Private conversation",color:"orange"},null,8,["modelValue"]),t[11]||(t[11]=i("div",{class:"text-caption text-grey-6 q-ml-lg"}," Private conversations are only visible to you ",-1))]),_:1})]),_:1}),i("div",Ve,[a(k,{flat:"",label:"Cancel",color:"grey-7",onClick:j}),a(k,{type:"submit",label:r.value?"Save Changes":"Add Conversation",color:"primary",loading:q.value},null,8,["label","loading"])])]),_:1})])])]))]),_:1})]),_:1})]),_:1}))}},Ue=W(Qe,[["__scopeId","data-v-a585d664"]]);export{Ue as default};
