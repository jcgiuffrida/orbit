import{_ as j,d as C,c as G,e as H,f,w as s,C as Y,o as n,b as o,h as l,a as r,j as w,D as Z,i,u as y,t as m,l as k,F as J,p as K,L as W,m as X,n as ee,k as c,G as te,N as A,O as oe}from"./main-BSNfDbTQ.js";import{Q as P,a as ae}from"./QSelect-wSek9BIm.js";import{Q as se}from"./QSpinnerDots-COME6D_6.js";import{Q as $}from"./QChip-CiA8MApy.js";import{Q as le}from"./QTooltip-BTYvVAAz.js";import{f as ne,u as re,_ as ie,a as ce,Q as de,b as ue,c as me,d as Q,e as _}from"./NavigationDrawer-Cd3a0AvU.js";import{C as q}from"./ClosePopup-DzaA1-DZ.js";import{u as pe,g as V,c as ve,a as fe,b as _e}from"./contactAttempts-CQhiSC4p.js";import{f as ye,a as ge}from"./dateFormatting-FSBT3tMj.js";import"./QItemLabel-CDBU9do_.js";const Ce={class:"row items-center q-mb-lg"},we={class:"row q-col-gutter-md q-mb-lg"},ke={class:"col-12 col-md-6"},be={class:"col-12 col-md-3"},he={class:"col-12 col-md-3"},xe={key:0,class:"text-center q-pa-lg"},Ae={key:1,class:"text-center q-pa-xl"},Qe={class:"text-h6 text-negative q-mt-md"},qe={key:2,class:"text-center q-pa-xl"},Ve={class:"text-h6 text-grey-7 q-mt-md"},Te={key:3,class:"timeline-container"},De={class:"timeline-marker"},Le={class:"row items-start justify-between"},Fe={class:"col"},Se={class:"row items-center q-gutter-sm q-mb-sm"},ze={class:"text-h6 text-weight-medium"},Pe={class:"text-body2 text-grey-8 q-mb-sm"},$e={key:0,class:"text-body2 text-grey-7"},Ne={key:1,class:"text-caption text-positive q-mt-sm"},Ie={class:"col-auto"},Be={__name:"ContactAttemptsView",setup(Oe){const b=Y(),h=re(),d=pe(),g=C(!1),p=C(""),v=C(""),x=C("-date"),N=[...ve,{label:"All Types",value:""}],I=[{label:"Most Recent",value:"-date"},{label:"Oldest First",value:"date"},{label:"Type",value:"type"},{label:"Person (A-Z)",value:"person_name"}],T=G(()=>{let a=[...d.getContactAttemptsList];if(p.value){const e=p.value.toLowerCase().trim();a=a.filter(t=>{const u=(t.person_name||"").toLowerCase(),R=(t.notes||"").toLowerCase();return u.includes(e)||R.includes(e)})}return v.value&&(a=a.filter(e=>e.type===v.value)),a.sort((e,t)=>{switch(x.value){case"date":return new Date(e.date)-new Date(t.date);case"-date":return new Date(t.date)-new Date(e.date);case"type":return V(e.type).localeCompare(V(t.type));case"person_name":return(e.person_name||"").localeCompare(t.person_name||"");default:return 0}}),a}),D=a=>_e(a),B=a=>V(a),L=a=>fe(a),O=(a,e)=>!a||a.length<=e?a:a.substring(0,e).trim()+"...",F=async()=>{try{const a=d.contactAttemptsCount<=1;await d.fetchContactAttempts(a)}catch(a){console.error("Error loading contact attempts:",a)}},S=()=>{b.push({name:"contact-attempt-create"})},z=a=>{b.push({name:"contact-attempt-edit",params:{id:a.id}})},M=a=>{b.push({name:"conversation-create",query:{participants:a.person,from_attempt:a.id}})},U=async a=>{h.dialog({title:"Delete Contact Attempt",message:`Are you sure you want to delete this contact attempt with ${a.person_name}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await d.deleteContactAttempt(a.id),h.notify({type:"positive",message:"Contact attempt deleted successfully",position:"top",timeout:3e3})}catch(e){console.error("Failed to delete contact attempt:",e),h.notify({type:"negative",message:"Failed to delete contact attempt. Please try again.",position:"top",timeout:4e3})}})},E=(a,e)=>{};return H(()=>{F()}),(a,e)=>(n(),f(ne,{view:"lHh Lpr lFf"},{default:s(()=>[o(ie,{onToggleDrawer:e[0]||(e[0]=t=>g.value=!g.value)}),o(ce,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t)},null,8,["modelValue"]),o(de,null,{default:s(()=>[o(ue,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[l("div",Ce,[e[5]||(e[5]=l("div",{class:"text-h4 col"},"Pings",-1)),o(w,{color:"primary",icon:"add",label:"Add Ping",onClick:S})]),l("div",we,[l("div",ke,[o(Z,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),filled:"",placeholder:"Search pings...",clearable:""},{prepend:s(()=>[o(i,{name:"search"})]),_:1},8,["modelValue"])]),l("div",be,[o(P,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),filled:"",options:N,label:"Filter by type","emit-value":"","map-options":"",clearable:""},null,8,["modelValue"])]),l("div",he,[o(P,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=t=>x.value=t),filled:"",options:I,label:"Sort by","emit-value":"","map-options":""},null,8,["modelValue"])])]),y(d).isLoading?(n(),r("div",xe,[o(se,{size:"50px",color:"primary"}),e[6]||(e[6]=l("div",{class:"q-mt-md"},"Loading pings...",-1))])):y(d).hasError?(n(),r("div",Ae,[o(i,{name:"error_outline",size:"80px",color:"negative"}),l("div",Qe,m(y(d).error),1),o(w,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:F})])):T.value.length===0?(n(),r("div",qe,[o(i,{name:"contact_phone",size:"80px",color:"grey-5"}),l("div",Ve,m(p.value||v.value?"No pings found matching your criteria":"No pings recorded yet"),1),!p.value&&!v.value?(n(),f(w,{key:0,color:"primary",label:"Add Your First Contact Attempt",class:"q-mt-md",onClick:S})):k("",!0)])):(n(),r("div",Te,[(n(!0),r(J,null,K(T.value,t=>(n(),r("div",{key:t.id,class:"timeline-item q-mb-md"},[l("div",De,[o(W,{size:"40px",color:L(t.type),"text-color":"white"},{default:s(()=>[o(i,{name:D(t.type),size:"20px"},null,8,["name"])]),_:2},1032,["color"])]),o(X,{class:"timeline-card cursor-pointer",onClick:u=>z(t)},{default:s(()=>[o(ee,null,{default:s(()=>[l("div",Le,[l("div",Fe,[l("div",Se,[l("div",ze,m(t.person_name||"Unknown Person"),1),o($,{size:"sm",color:L(t.type),"text-color":"white",icon:D(t.type)},{default:s(()=>[c(m(B(t.type)),1)]),_:2},1032,["color","icon"]),t.private?(n(),f($,{key:0,size:"sm",color:"orange","text-color":"white",icon:"lock"},{default:s(()=>[...e[7]||(e[7]=[c(" Private ",-1)])]),_:1})):k("",!0)]),l("div",Pe,[c(m(y(ye)(t.date))+" ",1),o(le,null,{default:s(()=>[c(m(y(ge)(t.date)),1)]),_:2},1024)]),t.notes?(n(),r("div",$e,m(O(t.notes,150)),1)):k("",!0),t.led_to_conversation?(n(),r("div",Ne,[o(i,{name:"arrow_forward",size:"14px",class:"q-mr-xs"}),e[8]||(e[8]=c(" Led to conversation ",-1))])):k("",!0)]),l("div",Ie,[o(w,{flat:"",round:"",size:"sm",icon:"more_vert",onClick:te(u=>E(u,t),["stop"])},{default:s(()=>[o(ae,null,{default:s(()=>[o(me,{style:{"min-width":"100px"}},{default:s(()=>[A((n(),f(Q,{clickable:"",onClick:u=>z(t)},{default:s(()=>[o(_,{avatar:""},{default:s(()=>[o(i,{name:"edit"})]),_:1}),o(_,null,{default:s(()=>[...e[9]||(e[9]=[c("Edit",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]]),A((n(),f(Q,{clickable:"",onClick:u=>M(t)},{default:s(()=>[o(_,{avatar:""},{default:s(()=>[o(i,{name:"chat_bubble"})]),_:1}),o(_,null,{default:s(()=>[...e[10]||(e[10]=[c("Add Conversation",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]]),o(oe),A((n(),f(Q,{clickable:"",onClick:u=>U(t)},{default:s(()=>[o(_,{avatar:""},{default:s(()=>[o(i,{name:"delete",color:"negative"})]),_:1}),o(_,{class:"text-negative"},{default:s(()=>[...e[11]||(e[11]=[c("Delete",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]))]),_:1})]),_:1})]),_:1}))}},Ke=j(Be,[["__scopeId","data-v-920bc159"]]);export{Ke as default};
