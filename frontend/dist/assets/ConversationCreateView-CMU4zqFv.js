import{Q as ae,a as oe}from"./QSpinnerDots-DKX6m9Q8.js";import{_ as le,d as u,c as $,M as se,I as ne,J as j,e as ie,f as _,w as s,D as re,o as d,b as a,a as h,h as i,t as p,i as I,j as T,l as C,m as B,n as E,k as y,P as z,R as M,E as W,u as ue,S as de}from"./main-BNYyCrAV.js";import{Q as pe,a as A}from"./QBreadcrumbs-C5l2t67P.js";import{Q}from"./QItemLabel-Co7gJjbr.js";import{f as ce,u as me,_ as ve,a as fe,Q as ye,b as ge,d as O,e as g}from"./NavigationDrawer-CoZBpgI1.js";import{Q as U}from"./QSelect-D7AnBUJS.js";import{Q as be}from"./QForm-09iU-u3O.js";import{u as _e,c as Ce}from"./conversations-DG4JxOq_.js";import{u as xe}from"./people-DXZZurFb.js";import"./position-engine--pu8bc_Q.js";const we={key:0,class:"text-center q-pa-xl"},qe={class:"q-mt-md"},Ve={key:1,class:"text-center q-pa-xl"},he={class:"text-h6 text-negative q-mt-md"},Qe={key:2},Le={class:"breadcrumb-nav q-mb-md"},Pe={class:"row justify-center"},ke={class:"col-12 col-md-10 col-lg-8"},Se={key:0,class:"text-caption q-ml-xs"},De={class:"row q-gutter-sm justify-end q-mt-lg"},Fe={__name:"ConversationCreateView",setup(Ie){const v=se(),c=re(),L=me(),x=_e(),m=xe(),w=u(!1),P=u(!1),k=u(!1),S=u(!1),D=u(null),n=u(null),r=$(()=>v.params.id&&v.params.id!=="new"),o=ne({participants:[],date:new Date().toISOString().split("T")[0],type:"",location:"",notes:"",private:!1}),q=u([]),V=u([]),b=u([]),H=()=>{o.participants=[],o.date=new Date().toISOString().split("T")[0],o.type="",o.location="",o.notes="",o.private=!1};$(()=>m.getPeopleList);const N=l=>{P.value=l,l&&(S.value=!1,D.value=null)},J=l=>{S.value=!0,D.value=l,P.value=!1},R=async()=>{if(m.getPeopleList.length===0)try{await m.fetchPeople()}catch(l){console.error("Failed to load people:",l)}b.value=[...m.getPeopleList]},F=async()=>{N(!0);try{if(await R(),r.value){const l=v.params.id;await x.fetchConversationById(l),n.value=x.selectedConversation,n.value&&(o.participants=n.value.participants.map(t=>t.id),o.date=n.value.date,o.type=n.value.type,o.location=n.value.location||"",o.notes=n.value.notes||"",o.private=n.value.private||!1)}else v.query.participants&&(o.participants=v.query.participants.split(","))}catch(l){console.error("Failed to load data:",l),J("Failed to load data")}finally{N(!1)}},K=async()=>{k.value=!0;try{const l={participant_ids:o.participants,date:o.date,type:o.type,location:o.location===null?"":o.location||"",notes:o.notes,private:o.private};if(r.value){const t=await x.updateConversation(n.value.id,l);L.notify({type:"positive",message:"Conversation updated successfully",position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),c.push({name:"conversation-detail",params:{id:t.id}})}else{const t=await x.createConversation(l);L.notify({type:"positive",message:"Conversation added successfully",position:"top",timeout:6e3,actions:[{icon:"add",color:"white",dense:!0,label:"Add Another",handler:()=>{H(),c.push({name:"conversation-create"})}},{icon:"close",color:"white",dense:!0}]}),c.push({name:"conversation-detail",params:{id:t.id}})}}catch(l){console.error("Failed to save conversation:",l),L.notify({type:"negative",message:`Failed to ${r.value?"update":"create"} conversation. Please try again.`,position:"top",timeout:4e3})}finally{k.value=!1}},G=()=>{r.value&&n.value?c.push({name:"conversation-detail",params:{id:n.value.id}}):c.push({name:"conversations"})},X=()=>{c.push({name:"conversations"})},Y=()=>{r.value&&n.value&&c.push({name:"conversation-detail",params:{id:n.value.id}})},Z=async()=>{try{const t=await(await fetch("/api/suggestions/conversation-locations/")).json();q.value=t.locations||[],V.value=[...q.value]}catch(l){console.error("Failed to load conversation location suggestions:",l)}},ee=(l,t)=>{t(()=>{if(l==="")V.value=[...q.value];else{const e=l.toLowerCase();V.value=q.value.filter(f=>f.toLowerCase().indexOf(e)>-1)}})},te=(l,t)=>{t(()=>{if(l==="")b.value=[...m.getPeopleList];else{const e=l.toLowerCase();b.value=m.getPeopleList.filter(f=>f.name.toLowerCase().includes(e)||f.name_ext&&f.name_ext.toLowerCase().includes(e))}})};return j(()=>v.params.id,(l,t)=>{l&&l!==t&&F()}),ie(()=>{F(),Z()}),j(()=>m.getPeopleList,l=>{b.value=[...l]},{immediate:!0}),(l,t)=>(d(),_(ce,{view:"lHh Lpr lFf"},{default:s(()=>[a(ve,{onToggleDrawer:t[0]||(t[0]=e=>w.value=!w.value)}),a(fe,{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=e=>w.value=e)},null,8,["modelValue"]),a(ye,null,{default:s(()=>[a(ge,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[P.value?(d(),h("div",we,[a(ae,{size:"50px",color:"primary"}),i("div",qe,p(r.value?"Loading conversation details...":"Loading..."),1)])):S.value?(d(),h("div",Ve,[a(I,{name:"error_outline",size:"80px",color:"negative"}),i("div",he,p(D.value),1),a(T,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:F})])):(d(),h("div",Qe,[i("div",Le,[a(pe,{class:"text-grey-6"},{default:s(()=>[a(A,{icon:"chat",label:"Conversations",onClick:X,class:"cursor-pointer"}),r.value?(d(),_(A,{key:0,label:n.value?.participants?.map(e=>e.name).join(", ")||"Conversation",onClick:Y,class:"cursor-pointer"},null,8,["label"])):C("",!0),a(A,{label:r.value?"Edit":"Add Conversation"},null,8,["label"])]),_:1})]),i("div",Pe,[i("div",ke,[a(be,{onSubmit:K,class:"q-gutter-md",autocomplete:"off"},{default:s(()=>[a(B,null,{default:s(()=>[a(E,null,{default:s(()=>[t[9]||(t[9]=i("div",{class:"text-h6 q-mb-md"},"Conversation Details",-1)),a(U,{modelValue:o.participants,"onUpdate:modelValue":t[2]||(t[2]=e=>o.participants=e),options:b.value,label:"Participants *",filled:"",multiple:"",required:"","option-value":"id","emit-value":"","map-options":"","use-chips":"","stack-label":"","use-input":"","input-debounce":"0",autocomplete:"off",class:"q-mb-md",rules:[e=>e&&e.length>0||"At least one participant is required"],onPopupShow:R,onFilter:te},{option:s(e=>[a(O,z(M(e.itemProps)),{default:s(()=>[a(g,null,{default:s(()=>[a(Q,null,{default:s(()=>[y(p(e.opt.name),1)]),_:2},1024),e.opt.name_ext?(d(),_(Q,{key:0,caption:""},{default:s(()=>[y(p(e.opt.name_ext),1)]),_:2},1024)):C("",!0)]),_:2},1024)]),_:2},1040)]),"selected-item":s(e=>[a(oe,{removable:"",onRemove:f=>e.removeAtIndex(e.index),tabindex:e.tabindex,class:"q-ma-xs"},{default:s(()=>[y(p(e.opt.name)+" ",1),e.opt.name_ext?(d(),h("span",Se,"("+p(e.opt.name_ext)+")",1)):C("",!0)]),_:2},1032,["onRemove","tabindex"])]),_:1},8,["modelValue","options","rules"]),a(W,{modelValue:o.date,"onUpdate:modelValue":t[3]||(t[3]=e=>o.date=e),label:"Date *",type:"date",filled:"",required:"",autocomplete:"off",class:"q-mb-md",rules:[e=>!!e||"Date is required"]},null,8,["modelValue","rules"]),a(U,{modelValue:o.type,"onUpdate:modelValue":t[4]||(t[4]=e=>o.type=e),options:ue(Ce),label:"Conversation Type *",filled:"",required:"","option-value":"value","option-label":"label","emit-value":"","map-options":"",autocomplete:"off",class:"q-mb-md",rules:[e=>!!e||"Conversation type is required"]},{"selected-item":s(e=>[e.opt.icon?(d(),_(g,{key:0,avatar:""},{default:s(()=>[a(I,{name:e.opt.icon},null,8,["name"])]),_:2},1024)):C("",!0),a(g,null,{default:s(()=>[a(Q,null,{default:s(()=>[y(p(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),option:s(e=>[a(O,z(M(e.itemProps)),{default:s(()=>[e.opt.icon?(d(),_(g,{key:0,avatar:""},{default:s(()=>[a(I,{name:e.opt.icon},null,8,["name"])]),_:2},1024)):C("",!0),a(g,null,{default:s(()=>[a(Q,null,{default:s(()=>[y(p(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"]),a(U,{modelValue:o.location,"onUpdate:modelValue":t[5]||(t[5]=e=>o.location=e),label:"Location",hint:"Where did this conversation take place?",filled:"","use-input":"",clearable:"","input-debounce":"0","new-value-mode":"add-unique",options:V.value,onFilter:ee,class:"q-mb-md"},{"no-option":s(()=>[a(O,null,{default:s(()=>[a(g,{class:"text-grey"},{default:s(()=>[...t[8]||(t[8]=[y(" Type to add new location ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),a(B,null,{default:s(()=>[a(E,null,{default:s(()=>[t[10]||(t[10]=i("div",{class:"text-h6 q-mb-md"},"Notes",-1)),a(W,{modelValue:o.notes,"onUpdate:modelValue":t[6]||(t[6]=e=>o.notes=e),label:"Conversation notes *",type:"textarea",rows:"6",filled:"",required:"",autocomplete:"off",hint:"What was discussed? Key topics, outcomes, follow-ups needed, etc.",class:"q-mb-md",rules:[e=>!!e||"Notes are required"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(B,null,{default:s(()=>[a(E,null,{default:s(()=>[t[11]||(t[11]=i("div",{class:"text-h6 q-mb-md"},"Privacy Settings",-1)),a(de,{modelValue:o.private,"onUpdate:modelValue":t[7]||(t[7]=e=>o.private=e),label:"Private conversation",color:"orange"},null,8,["modelValue"]),t[12]||(t[12]=i("div",{class:"text-caption text-grey-6 q-ml-lg"}," Private conversations are only visible to you ",-1))]),_:1})]),_:1}),i("div",De,[a(T,{flat:"",label:"Cancel",color:"grey-7",onClick:G}),a(T,{type:"submit",label:r.value?"Save Changes":"Add Conversation",color:"primary",loading:k.value},null,8,["label","loading"])])]),_:1})])])]))]),_:1})]),_:1})]),_:1}))}},ze=le(Fe,[["__scopeId","data-v-bc53d524"]]);export{ze as default};
