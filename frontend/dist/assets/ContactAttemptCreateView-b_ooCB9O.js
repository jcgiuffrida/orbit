import{Q as J}from"./QSpinnerDots-BsIIeB5d.js";import{_ as G,d as c,c as L,M as K,I as X,J as Y,e as Z,f as v,w as l,u as ee,o as d,b as a,a as x,h as r,t as m,i as k,j as S,l as b,n as te,p as ae,P as B,R as E,k as C,m as oe,E as F,S as U}from"./main-BtbfkAaC.js";import{Q as le,a as T}from"./QBreadcrumbs-D-UkWGgU.js";import{Q as h}from"./QItemLabel-eG93G_dM.js";import{f as se,u as ne,_ as re,a as ie,Q as ue,b as de,d as $,e as f}from"./NavigationDrawer-DiYLZfbT.js";import{Q as N}from"./QSelect-CG3_3xNS.js";import{Q as pe}from"./QForm-CbK6kz7O.js";import{u as ce,c as me}from"./contactAttempts-Db7ca-o9.js";import{u as ve}from"./people-CpNVsY3R.js";import"./position-engine-C8qud-4P.js";const fe={key:0,class:"text-center q-pa-xl"},ge={class:"q-mt-md"},ye={key:1,class:"text-center q-pa-xl"},_e={class:"text-h6 text-negative q-mt-md"},be={key:2},Ce={class:"breadcrumb-nav q-mb-md"},he={class:"row justify-center"},Ve={class:"col-12 col-md-8 col-lg-6"},Pe={class:"row q-col-gutter-sm"},we={class:"col-7 col-sm-6"},qe={class:"col"},Qe={class:"row q-gutter-sm justify-end q-mt-lg"},Ae={__name:"ContactAttemptCreateView",setup(xe){const p=K(),i=ee(),g=ne(),y=ce(),V=ve(),_=c(!1),P=c(!1),w=c(!1),q=c(!1),Q=c(null),n=c(null),u=L(()=>p.params.id&&p.params.id!=="new"),e=X({person:"",date:new Date().toISOString().split("T")[0],type:"",notes:"",ledToConversation:!1,private:!1}),O=()=>{e.person="",e.date=new Date().toISOString().split("T")[0],e.type="",e.notes="",e.ledToConversation=!1,e.private=!1},R=L(()=>V.getPeopleList),D=s=>{P.value=s,s&&(q.value=!1,Q.value=null)},j=s=>{q.value=!0,Q.value=s,P.value=!1},I=async()=>{if(V.getPeopleList.length===0)try{await V.fetchPeople()}catch(s){console.error("Failed to load people:",s)}},A=async()=>{D(!0);try{if(await I(),p.query.person&&(e.person=p.query.person),u.value){const s=p.params.id;await y.fetchContactAttemptById(s),n.value=y.selectedContactAttempt,n.value&&(e.person=n.value.person,e.date=n.value.date,e.type=n.value.type,e.notes=n.value.notes||"",e.ledToConversation=!!n.value.led_to_conversation,e.private=n.value.private||!1)}}catch(s){console.error("Failed to load data:",s),j("Failed to load data")}finally{D(!1)}},z=async()=>{w.value=!0;try{const s={person:e.person,date:e.date,type:e.type,notes:e.notes||"",led_to_conversation:e.ledToConversation,private:e.private};if(u.value){const o=await y.updateContactAttempt(n.value.id,s);g.notify({type:"positive",message:"Ping updated successfully",position:"top",timeout:3e3,actions:[{icon:"close",color:"white",dense:!0}]}),i.push({name:"pings"})}else{const o=await y.createContactAttempt(s);g.notify({type:"positive",message:"Ping added successfully",position:"top",timeout:6e3,actions:[{icon:"add",color:"white",dense:!0,label:"Add Another",handler:()=>{O(),i.push({name:"ping-create"})}},{icon:"close",color:"white",dense:!0}]}),e.ledToConversation?g.dialog({title:"Create Conversation",message:"Would you like to record a conversation from this ping?",cancel:!0,persistent:!1}).onOk(()=>{i.push({name:"conversation-create",query:{participants:e.person,from_attempt:o.id,type:e.type==="call"?"phone":e.type,date:e.date}})}).onCancel(()=>{i.push({name:"pings"})}):i.push({name:"pings"})}}catch(s){console.error("Failed to save contact attempt:",s),g.notify({type:"negative",message:`Failed to ${u.value?"update":"create"} ping. Please try again.`,position:"top",timeout:4e3})}finally{w.value=!1}},M=()=>{i.push({name:"pings"})},W=()=>{i.push({name:"pings"})},H=()=>{u.value&&n.value&&i.push({name:"person-detail",params:{id:n.value.person}})};return Y(()=>p.params.id,(s,o)=>{s&&s!==o&&A()}),Z(()=>{A()}),(s,o)=>(d(),v(se,{view:"lHh Lpr lFf"},{default:l(()=>[a(re,{onToggleDrawer:o[0]||(o[0]=t=>_.value=!_.value)}),a(ie,{modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=t=>_.value=t)},null,8,["modelValue"]),a(ue,null,{default:l(()=>[a(de,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:l(()=>[P.value?(d(),x("div",fe,[a(J,{size:"50px",color:"primary"}),r("div",ge,m(u.value?"Loading ping details...":"Loading..."),1)])):q.value?(d(),x("div",ye,[a(k,{name:"error_outline",size:"80px",color:"negative"}),r("div",_e,m(Q.value),1),a(S,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:A})])):(d(),x("div",be,[r("div",Ce,[a(le,{class:"text-grey-6"},{default:l(()=>[a(T,{icon:"contact_phone",label:"Pings",onClick:W,class:"cursor-pointer"}),u.value&&n.value?(d(),v(T,{key:0,label:`${n.value.person_name||"Ping"}`,onClick:H,class:"cursor-pointer"},null,8,["label"])):b("",!0),a(T,{label:u.value?"Edit":"Add Ping"},null,8,["label"])]),_:1})]),r("div",he,[r("div",Ve,[a(pe,{onSubmit:z,class:"q-gutter-md",autocomplete:"off"},{default:l(()=>[a(te,null,{default:l(()=>[a(ae,null,{default:l(()=>[o[8]||(o[8]=r("div",{class:"text-h6 q-mb-md"},"Ping Details",-1)),a(N,{modelValue:e.person,"onUpdate:modelValue":o[2]||(o[2]=t=>e.person=t),options:R.value,label:"Person *",filled:"",required:"","option-value":"id","option-label":"name","emit-value":"","map-options":"",autocomplete:"off",rules:[t=>!!t||"Person is required"],onPopupShow:I},{option:l(t=>[a($,B(E(t.itemProps)),{default:l(()=>[a(f,null,{default:l(()=>[a(h,null,{default:l(()=>[C(m(t.opt.name),1)]),_:2},1024),t.opt.name_ext?(d(),v(h,{key:0,caption:""},{default:l(()=>[C(m(t.opt.name_ext),1)]),_:2},1024)):b("",!0)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"]),r("div",Pe,[r("div",we,[a(N,{modelValue:e.type,"onUpdate:modelValue":o[3]||(o[3]=t=>e.type=t),options:oe(me),label:"Contact Type *",filled:"",required:"","option-value":"value","option-label":"label","emit-value":"","map-options":"",autocomplete:"off",rules:[t=>!!t||"Contact type is required"]},{"selected-item":l(t=>[t.opt.icon?(d(),v(f,{key:0,avatar:""},{default:l(()=>[a(k,{name:t.opt.icon},null,8,["name"])]),_:2},1024)):b("",!0),a(f,null,{default:l(()=>[a(h,null,{default:l(()=>[C(m(t.opt.label),1)]),_:2},1024)]),_:2},1024)]),option:l(t=>[a($,B(E(t.itemProps)),{default:l(()=>[t.opt.icon?(d(),v(f,{key:0,avatar:""},{default:l(()=>[a(k,{name:t.opt.icon},null,8,["name"])]),_:2},1024)):b("",!0),a(f,null,{default:l(()=>[a(h,null,{default:l(()=>[C(m(t.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),r("div",qe,[a(F,{modelValue:e.date,"onUpdate:modelValue":o[4]||(o[4]=t=>e.date=t),label:"Date *",type:"date",filled:"",required:"",autocomplete:"off",rules:[t=>!!t||"Date is required"]},null,8,["modelValue","rules"])])]),a(F,{modelValue:e.notes,"onUpdate:modelValue":o[5]||(o[5]=t=>e.notes=t),label:"Notes",type:"textarea",rows:"2",filled:"",autocomplete:"off",hint:"What was the purpose? Any response or outcome?",class:"q-mb-md"},null,8,["modelValue"]),a(U,{modelValue:e.ledToConversation,"onUpdate:modelValue":o[6]||(o[6]=t=>e.ledToConversation=t),label:"This led to a conversation",color:"positive"},null,8,["modelValue"]),o[9]||(o[9]=r("br",null,null,-1)),a(U,{modelValue:e.private,"onUpdate:modelValue":o[7]||(o[7]=t=>e.private=t),label:"Private ping",color:"orange"},null,8,["modelValue"]),o[10]||(o[10]=r("div",{class:"text-caption text-grey-6 q-ml-lg"}," Private pings are only visible to you ",-1))]),_:1})]),_:1}),r("div",Qe,[a(S,{flat:"",label:"Cancel",color:"grey-7",onClick:M}),a(S,{type:"submit",label:u.value?"Save Changes":"Add Ping",color:"primary",loading:w.value},null,8,["label","loading"])])]),_:1})])])]))]),_:1})]),_:1})]),_:1}))}},$e=G(Ae,[["__scopeId","data-v-113ab335"]]);export{$e as default};
