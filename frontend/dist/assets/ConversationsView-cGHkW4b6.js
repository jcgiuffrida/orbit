import{_ as Y,d as w,c as Z,e as J,f as v,w as s,u as K,o as n,b as a,h as l,a as d,j as h,E as W,i as c,m as k,t as u,l as Q,F as X,q as ee,n as te,p as oe,L as ae,k as f,G as se,N as q,O as le}from"./main-C8eLUZHf.js";import{Q as z,a as ne}from"./QSelect-7DMXMTRB.js";import{Q as re,a as I}from"./QSpinnerDots-rM26rU5M.js";import{f as ie,u as de,_ as ce,a as ue,Q as pe,b as me,c as ve,d as V,e as y}from"./NavigationDrawer-CgCiqeaQ.js";import{C as T}from"./ClosePopup-BtKQzpV0.js";import{u as fe,b as L,c as ye,g as _e,a as Ce}from"./conversations-Coh1HZj_.js";import{a as ge}from"./dateFormatting-Bb5cIjpU.js";import"./QItemLabel-DOCnpRxJ.js";import"./position-engine-CYTD2jtF.js";const we={class:"row items-center q-mb-lg"},he={class:"row q-col-gutter-md q-mb-lg"},ke={class:"col-12 col-md-6"},be={class:"col-12 col-md-3"},xe={class:"col-12 col-md-3"},Qe={key:0,class:"text-center q-pa-lg"},qe={key:1,class:"text-center q-pa-xl"},Ve={class:"text-h6 text-negative q-mt-md"},Te={key:2,class:"text-center q-pa-xl"},Le={class:"text-h6 text-grey-7 q-mt-md"},De={key:3,class:"row q-col-gutter-md"},Fe={class:"row items-start q-gutter-md"},Se={class:"col-auto"},Ne={class:"col"},$e={class:"row items-center q-gutter-sm q-mb-xs"},ze={class:"text-h6"},Ie={class:"text-body2 text-grey-8 q-mb-sm"},Ae={key:0},Pe={class:"text-body2 text-grey-7 conversation-notes"},Be={class:"col-auto"},Oe={__name:"ConversationsView",setup(Ue){const C=K(),b=de(),r=fe(),g=w(!1),p=w(""),m=w(""),x=w("-date"),A=[...ye,{label:"All Types",value:""}],P=[{label:"Most Recent",value:"-date"},{label:"Oldest First",value:"date"},{label:"Type",value:"type"},{label:"Participants (A-Z)",value:"participants"}],D=Z(()=>{let t=[...r.getConversationsList];if(p.value){const e=p.value.toLowerCase().trim();t=t.filter(o=>{const i=_(o.participants).toLowerCase(),G=o.notes.toLowerCase(),H=o.location?.toLowerCase()||"";return i.includes(e)||G.includes(e)||H.includes(e)})}return m.value&&(t=t.filter(e=>e.type===m.value)),t.sort((e,o)=>{switch(x.value){case"date":return new Date(e.date)-new Date(o.date);case"-date":return new Date(o.date)-new Date(e.date);case"type":return L(e.type).localeCompare(L(o.type));case"participants":return _(e.participants).localeCompare(_(o.participants));default:return 0}}),t}),_=t=>!t||t.length===0?"Unknown":t.map(e=>e.name).join(", "),F=t=>Ce(t),B=t=>L(t),S=t=>_e(t),O=(t,e)=>!t||t.length<=e?t:t.substring(0,e).trim()+"...",N=async()=>{try{const t=r.conversationsCount<=1;await r.fetchConversations(t)}catch(t){console.error("Error loading conversations:",t)}},U=t=>{C.push({name:"conversation-detail",params:{id:t.id}})},$=()=>{C.push({name:"conversation-create"})},E=t=>{C.push({name:"conversation-edit",params:{id:t.id}})},M=t=>{const e=t.participants.map(o=>o.id);C.push({name:"conversation-create",query:{participants:e.join(","),followup:t.id}})},j=async t=>{b.dialog({title:"Delete Conversation",message:`Are you sure you want to delete this conversation with ${_(t.participants)}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await r.deleteConversation(t.id),b.notify({type:"positive",message:"Conversation deleted successfully",position:"top",timeout:3e3})}catch(e){console.error("Failed to delete conversation:",e),b.notify({type:"negative",message:"Failed to delete conversation. Please try again.",position:"top",timeout:4e3})}})},R=(t,e)=>{};return J(()=>{N()}),(t,e)=>(n(),v(ie,{view:"lHh Lpr lFf"},{default:s(()=>[a(ce,{onToggleDrawer:e[0]||(e[0]=o=>g.value=!g.value)}),a(ue,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=o=>g.value=o)},null,8,["modelValue"]),a(pe,null,{default:s(()=>[a(me,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[l("div",we,[e[5]||(e[5]=l("div",{class:"text-h4 col"},"Conversations",-1)),a(h,{color:"primary",icon:"add",label:"Add Conversation",onClick:$})]),l("div",he,[l("div",ke,[a(W,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=o=>p.value=o),filled:"",placeholder:"Search conversations...",clearable:""},{prepend:s(()=>[a(c,{name:"search"})]),_:1},8,["modelValue"])]),l("div",be,[a(z,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=o=>m.value=o),filled:"",options:A,label:"Filter by type","emit-value":"","map-options":"",clearable:""},null,8,["modelValue"])]),l("div",xe,[a(z,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=o=>x.value=o),filled:"",options:P,label:"Sort by","emit-value":"","map-options":""},null,8,["modelValue"])])]),k(r).isLoading?(n(),d("div",Qe,[a(re,{size:"50px",color:"primary"}),e[6]||(e[6]=l("div",{class:"q-mt-md"},"Loading conversations...",-1))])):k(r).hasError?(n(),d("div",qe,[a(c,{name:"error_outline",size:"80px",color:"negative"}),l("div",Ve,u(k(r).error),1),a(h,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:N})])):D.value.length===0?(n(),d("div",Te,[a(c,{name:"chat_bubble_outline",size:"80px",color:"grey-5"}),l("div",Le,u(p.value||m.value?"No conversations found matching your criteria":"No conversations recorded yet"),1),!p.value&&!m.value?(n(),v(h,{key:0,color:"primary",label:"Add Your First Conversation",class:"q-mt-md",onClick:$})):Q("",!0)])):(n(),d("div",De,[(n(!0),d(X,null,ee(D.value,o=>(n(),d("div",{key:o.id,class:"col-12"},[a(te,{class:"conversation-card cursor-pointer",onClick:i=>U(o)},{default:s(()=>[a(oe,null,{default:s(()=>[l("div",Fe,[l("div",Se,[a(ae,{size:"48px",color:S(o.type),"text-color":"white"},{default:s(()=>[a(c,{name:F(o.type),size:"24px"},null,8,["name"])]),_:2},1032,["color"])]),l("div",Ne,[l("div",$e,[l("div",ze,u(_(o.participants)),1),a(I,{size:"sm",color:S(o.type),"text-color":"white",icon:F(o.type)},{default:s(()=>[f(u(B(o.type)),1)]),_:2},1032,["color","icon"]),o.private?(n(),v(I,{key:0,size:"sm",color:"orange","text-color":"white",icon:"lock"},{default:s(()=>[...e[7]||(e[7]=[f(" Private ",-1)])]),_:1})):Q("",!0)]),l("div",Ie,[f(u(k(ge)(o.date))+" ",1),o.location?(n(),d("span",Ae," â€¢ "+u(o.location),1)):Q("",!0)]),l("div",Pe,u(O(o.notes,150)),1)]),l("div",Be,[a(h,{flat:"",round:"",size:"sm",icon:"more_vert",onClick:se(i=>R(i,o),["stop"])},{default:s(()=>[a(ne,null,{default:s(()=>[a(ve,{style:{"min-width":"100px"}},{default:s(()=>[q((n(),v(V,{clickable:"",onClick:i=>E(o)},{default:s(()=>[a(y,{avatar:""},{default:s(()=>[a(c,{name:"edit"})]),_:1}),a(y,null,{default:s(()=>[...e[8]||(e[8]=[f("Edit",-1)])]),_:1})]),_:2},1032,["onClick"])),[[T]]),q((n(),v(V,{clickable:"",onClick:i=>M(o)},{default:s(()=>[a(y,{avatar:""},{default:s(()=>[a(c,{name:"add_comment"})]),_:1}),a(y,null,{default:s(()=>[...e[9]||(e[9]=[f("Follow-up",-1)])]),_:1})]),_:2},1032,["onClick"])),[[T]]),a(le),q((n(),v(V,{clickable:"",onClick:i=>j(o)},{default:s(()=>[a(y,{avatar:""},{default:s(()=>[a(c,{name:"delete",color:"negative"})]),_:1}),a(y,{class:"text-negative"},{default:s(()=>[...e[10]||(e[10]=[f("Delete",-1)])]),_:1})]),_:2},1032,["onClick"])),[[T]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]))]),_:1})]),_:1})]),_:1}))}},Ke=Y(Oe,[["__scopeId","data-v-073bde64"]]);export{Ke as default};
