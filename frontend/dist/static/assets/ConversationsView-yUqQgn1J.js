import{_ as Z,d as k,c as J,e as K,f as y,w as s,B as W,o as l,b as a,h as n,a as d,j as b,C as X,i as u,D as q,t as p,n as V,F as ee,p as te,l as oe,m as ae,L as se,k as _,G as ne,a1 as D,a2 as le}from"./main-lLcixNdV.js";import{Q as N,e as re}from"./QSelect-BORB3w1x.js";import{Q as ie}from"./QSpinnerDots-C1RhdbIz.js";import{Q as A}from"./QChip-Dg7wEueL.js";import{f as ce,u as de,_ as ue,a as pe,Q as me,b as ve,c as fe,d as T,e as g}from"./NavigationDrawer-BHW7As8Z.js";import{C as L}from"./ClosePopup-DoQKbu6O.js";import{u as ye,a as $,c as _e,g as ge}from"./conversations-C41hdLLe.js";import"./QItemLabel-DHrqC5DY.js";const Ce={class:"row items-center q-mb-lg"},we={class:"row q-col-gutter-md q-mb-lg"},he={class:"col-12 col-md-6"},ke={class:"col-12 col-md-3"},be={class:"col-12 col-md-3"},xe={key:0,class:"text-center q-pa-lg"},Qe={key:1,class:"text-center q-pa-xl"},qe={class:"text-h6 text-negative q-mt-md"},Ve={key:2,class:"text-center q-pa-xl"},De={class:"text-h6 text-grey-7 q-mt-md"},Te={key:3,class:"row q-col-gutter-md"},Le={class:"row items-start q-gutter-md"},$e={class:"col-auto"},Fe={class:"col"},Se={class:"row items-center q-gutter-sm q-mb-xs"},ze={class:"text-h6"},Ie={class:"text-body2 text-grey-8 q-mb-sm"},Me={key:0},Ne={class:"text-body2 text-grey-7 conversation-notes"},Ae={class:"col-auto"},Be={__name:"ConversationsView",setup(Pe){const w=W(),x=de(),m=ye(),h=k(!1),v=k(""),f=k(""),Q=k("-date"),B=[..._e,{label:"All Types",value:""}],P=[{label:"Most Recent",value:"-date"},{label:"Oldest First",value:"date"},{label:"Type",value:"type"},{label:"Participants (A-Z)",value:"participants"}],F=J(()=>{let t=[...m.getConversationsList];if(v.value){const e=v.value.toLowerCase().trim();t=t.filter(o=>{const i=C(o.participants).toLowerCase(),r=o.notes.toLowerCase(),c=o.location?.toLowerCase()||"";return i.includes(e)||r.includes(e)||c.includes(e)})}return f.value&&(t=t.filter(e=>e.type===f.value)),t.sort((e,o)=>{switch(Q.value){case"date":return new Date(e.date)-new Date(o.date);case"-date":return new Date(o.date)-new Date(e.date);case"type":return $(e.type).localeCompare($(o.type));case"participants":return C(e.participants).localeCompare(C(o.participants));default:return 0}}),t}),C=t=>!t||t.length===0?"Unknown":t.map(e=>e.name).join(", "),S=t=>ge(t),U=t=>$(t),z=t=>({in_person:"primary",phone:"positive",text:"info",email:"secondary",video:"accent",other:"grey-6"})[t]||"grey-6",O=t=>{if(!t)return"";const e=new Date(t),i=new Date-e,r=Math.floor(i/(1e3*60*60*24));if(r===0)return"Today";if(r===1)return"Yesterday";if(r<7)return`${r} days ago`;if(r<30){const c=Math.floor(r/7);return c===1?"1 week ago":`${c} weeks ago`}if(r<365){const c=Math.floor(r/30);return c===1?"1 month ago":`${c} months ago`}return e.toLocaleDateString()},E=(t,e)=>!t||t.length<=e?t:t.substring(0,e).trim()+"...",I=async()=>{try{await m.fetchConversations()}catch(t){console.error("Error loading conversations:",t)}},j=t=>{w.push({name:"conversation-detail",params:{id:t.id}})},M=()=>{w.push({name:"conversation-create"})},R=t=>{w.push({name:"conversation-edit",params:{id:t.id}})},Y=t=>{const e=t.participants.map(o=>o.id);w.push({name:"conversation-create",query:{participants:e.join(","),followup:t.id}})},G=async t=>{x.dialog({title:"Delete Conversation",message:`Are you sure you want to delete this conversation with ${C(t.participants)}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await m.deleteConversation(t.id),x.notify({type:"negative",message:"Conversation deleted successfully",position:"top",timeout:3e3})}catch(e){console.error("Failed to delete conversation:",e),x.notify({type:"negative",message:"Failed to delete conversation. Please try again.",position:"top",timeout:4e3})}})},H=(t,e)=>{};return K(()=>{I()}),(t,e)=>(l(),y(ce,{view:"lHh Lpr lFf"},{default:s(()=>[a(ue,{onToggleDrawer:e[0]||(e[0]=o=>h.value=!h.value)}),a(pe,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=o=>h.value=o)},null,8,["modelValue"]),a(me,null,{default:s(()=>[a(ve,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:s(()=>[n("div",Ce,[e[5]||(e[5]=n("div",{class:"text-h4 col"},"Conversations",-1)),a(b,{color:"primary",icon:"add",label:"Add Conversation",onClick:M})]),n("div",we,[n("div",he,[a(X,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=o=>v.value=o),filled:"",placeholder:"Search conversations...",clearable:""},{prepend:s(()=>[a(u,{name:"search"})]),_:1},8,["modelValue"])]),n("div",ke,[a(N,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=o=>f.value=o),filled:"",options:B,label:"Filter by type","emit-value":"","map-options":"",clearable:""},null,8,["modelValue"])]),n("div",be,[a(N,{modelValue:Q.value,"onUpdate:modelValue":e[4]||(e[4]=o=>Q.value=o),filled:"",options:P,label:"Sort by","emit-value":"","map-options":""},null,8,["modelValue"])])]),q(m).isLoading?(l(),d("div",xe,[a(ie,{size:"50px",color:"primary"}),e[6]||(e[6]=n("div",{class:"q-mt-md"},"Loading conversations...",-1))])):q(m).hasError?(l(),d("div",Qe,[a(u,{name:"error_outline",size:"80px",color:"negative"}),n("div",qe,p(q(m).error),1),a(b,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:I})])):F.value.length===0?(l(),d("div",Ve,[a(u,{name:"chat_bubble_outline",size:"80px",color:"grey-5"}),n("div",De,p(v.value||f.value?"No conversations found matching your criteria":"No conversations recorded yet"),1),!v.value&&!f.value?(l(),y(b,{key:0,color:"primary",label:"Add Your First Conversation",class:"q-mt-md",onClick:M})):V("",!0)])):(l(),d("div",Te,[(l(!0),d(ee,null,te(F.value,o=>(l(),d("div",{key:o.id,class:"col-12"},[a(oe,{class:"conversation-card cursor-pointer",onClick:i=>j(o)},{default:s(()=>[a(ae,null,{default:s(()=>[n("div",Le,[n("div",$e,[a(se,{size:"48px",color:z(o.type),"text-color":"white"},{default:s(()=>[a(u,{name:S(o.type),size:"24px"},null,8,["name"])]),_:2},1032,["color"])]),n("div",Fe,[n("div",Se,[n("div",ze,p(C(o.participants)),1),a(A,{size:"sm",color:z(o.type),"text-color":"white",icon:S(o.type)},{default:s(()=>[_(p(U(o.type)),1)]),_:2},1032,["color","icon"]),o.private?(l(),y(A,{key:0,size:"sm",color:"orange","text-color":"white",icon:"lock"},{default:s(()=>[...e[7]||(e[7]=[_(" Private ",-1)])]),_:1})):V("",!0)]),n("div",Ie,[_(p(O(o.date))+" ",1),o.location?(l(),d("span",Me," â€¢ "+p(o.location),1)):V("",!0)]),n("div",Ne,p(E(o.notes,150)),1)]),n("div",Ae,[a(b,{flat:"",round:"",size:"sm",icon:"more_vert",onClick:ne(i=>H(i,o),["stop"])},{default:s(()=>[a(re,null,{default:s(()=>[a(fe,{style:{"min-width":"100px"}},{default:s(()=>[D((l(),y(T,{clickable:"",onClick:i=>R(o)},{default:s(()=>[a(g,{avatar:""},{default:s(()=>[a(u,{name:"edit"})]),_:1}),a(g,null,{default:s(()=>[...e[8]||(e[8]=[_("Edit",-1)])]),_:1})]),_:2},1032,["onClick"])),[[L]]),D((l(),y(T,{clickable:"",onClick:i=>Y(o)},{default:s(()=>[a(g,{avatar:""},{default:s(()=>[a(u,{name:"add_comment"})]),_:1}),a(g,null,{default:s(()=>[...e[9]||(e[9]=[_("Follow-up",-1)])]),_:1})]),_:2},1032,["onClick"])),[[L]]),a(le),D((l(),y(T,{clickable:"",onClick:i=>G(o)},{default:s(()=>[a(g,{avatar:""},{default:s(()=>[a(u,{name:"delete",color:"negative"})]),_:1}),a(g,{class:"text-negative"},{default:s(()=>[...e[10]||(e[10]=[_("Delete",-1)])]),_:1})]),_:2},1032,["onClick"])),[[L]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]))]),_:1})]),_:1})]),_:1}))}},Ze=Z(Be,[["__scopeId","data-v-93255033"]]);export{Ze as default};
