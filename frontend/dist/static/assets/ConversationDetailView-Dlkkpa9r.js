import{Q as j}from"./QSpinnerDots-C1RhdbIz.js";import{_ as H,d as S,c as R,J as Y,e as J,f as N,w as n,H as K,B as O,o as c,b as t,a as d,D as $,h as o,i as u,t as i,j as m,l as g,m as h,L,n as x,k as p,F as G,p as W,K as X,q as Z}from"./main-lLcixNdV.js";import{Q as ee,a as P}from"./QBreadcrumbs-RYE4jtEO.js";import{Q as F}from"./QChip-Dg7wEueL.js";import{f as te,u as oe,_ as se,a as ae,Q as ne,b as ie}from"./NavigationDrawer-BHW7As8Z.js";import{u as le,g as re,a as ce}from"./conversations-C41hdLLe.js";const de={key:0,class:"text-center q-pa-xl"},ue={key:1,class:"text-center q-pa-xl"},me={class:"text-h6 text-negative q-mt-md"},ve={key:2,class:"text-center q-pa-xl"},pe={key:3,class:"conversation-detail-container"},_e={class:"breadcrumb-nav q-mb-md"},fe={class:"row items-start q-gutter-md"},ye={class:"col-auto"},ge={class:"col"},he={class:"row items-center q-gutter-sm q-mb-sm"},xe={class:"text-h5 text-weight-medium"},we={class:"text-body1 text-grey-8 q-mb-sm"},be={key:0},qe={class:"text-body2 text-grey-6"},ke={key:0},Ce={class:"col-auto"},De={class:"action-buttons"},Qe={class:"row q-col-gutter-lg"},$e={class:"col-12 col-md-4"},Le={class:"detail-item q-mb-md"},Te={class:"row items-center q-gutter-sm"},Ve={class:"col"},ze={class:"text-body1"},Be={class:"detail-item q-mb-md"},Se={class:"row items-center q-gutter-sm"},Ne={class:"col"},Pe={class:"text-body1"},Fe={key:0,class:"detail-item q-mb-md"},Ie={class:"row items-center q-gutter-sm"},Ae={class:"col"},Me={class:"text-body1"},Ee={class:"detail-item"},Ue={class:"row items-center q-gutter-sm"},je={class:"col"},He={class:"text-body1"},Re=["onClick"],Ye={class:"col"},Je={class:"text-body2 text-weight-medium"},Ke={key:0,class:"text-caption text-grey-6"},Oe={class:"col-12 col-md-8"},Ge={class:"text-body1 text-grey-8 pre-line conversation-notes"},We={class:"q-ml-sm"},Xe={__name:"ConversationDetailView",setup(Ze){const T=K(),_=O(),V=oe(),v=le(),w=S(!1),f=S(!1),s=R(()=>v.selectedConversation),b=a=>!a||a.length===0?"Unknown":a.map(e=>e.name).join(", "),k=a=>re(a),z=a=>ce(a),C=a=>({in_person:"primary",phone:"positive",text:"info",email:"secondary",video:"accent",other:"grey-6"})[a]||"grey-6",I=a=>{if(!a)return"Never";const e=new Date(a),q=new Date-e,r=Math.floor(q/(1e3*60*60*24));if(r===0)return"Today";if(r===1)return"Yesterday";if(r<7)return`${r} days ago`;if(r<30){const y=Math.floor(r/7);return y===1?"1 week ago":`${y} weeks ago`}if(r<365){const y=Math.floor(r/30);return y===1?"1 month ago":`${y} months ago`}return e.toLocaleDateString()},D=a=>{if(!a)return"";const e=new Date(a),q=new Date-e,r=Math.floor(q/(1e3*60*60*24));return r===0?`Today, ${e.toLocaleDateString(void 0,{month:"long",day:"numeric",year:"numeric"})}`:r===1?`Yesterday, ${e.toLocaleDateString(void 0,{month:"long",day:"numeric",year:"numeric"})}`:r<7?e.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric",year:"numeric"}):e.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})},Q=async()=>{const a=T.params.id;if(a)try{await v.fetchConversationById(a)}catch(e){console.error("Failed to load conversation:",e)}},B=()=>{_.push({name:"conversations"})},A=()=>{s.value&&_.push({name:"conversation-edit",params:{id:s.value.id}})},M=()=>{if(s.value){const a=s.value.participants.map(e=>e.id);_.push({name:"conversation-create",query:{participants:a.join(","),followup:s.value.id}})}},E=a=>{_.push({name:"person-detail",params:{id:a.id}})},U=async()=>{if(s.value)try{const a=b(s.value.participants);await v.deleteConversation(s.value.id),f.value=!1,V.notify({type:"negative",message:`Conversation with ${a} deleted successfully`,position:"top",timeout:4e3,actions:[{icon:"close",color:"white",dense:!0}]}),_.push({name:"conversations"})}catch(a){console.error("Failed to delete conversation:",a),V.notify({type:"negative",message:"Failed to delete conversation. Please try again.",position:"top",timeout:4e3})}};return Y(()=>T.params.id,(a,e)=>{a&&a!==e&&Q()}),J(()=>{Q()}),(a,e)=>(c(),N(te,{view:"lHh Lpr lFf"},{default:n(()=>[t(se,{onToggleDrawer:e[0]||(e[0]=l=>w.value=!w.value)}),t(ae,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l)},null,8,["modelValue"]),t(ne,null,{default:n(()=>[t(ie,{class:"q-pa-md",style:{"background-color":"#f8f9fa"}},{default:n(()=>[$(v).isLoading?(c(),d("div",de,[t(j,{size:"50px",color:"primary"}),e[5]||(e[5]=o("div",{class:"q-mt-md"},"Loading conversation details...",-1))])):$(v).hasError?(c(),d("div",ue,[t(u,{name:"error_outline",size:"80px",color:"negative"}),o("div",me,i($(v).error),1),t(m,{color:"primary",label:"Try Again",class:"q-mt-md",onClick:Q})])):s.value?(c(),d("div",pe,[o("div",_e,[t(ee,{class:"text-grey-6"},{default:n(()=>[t(P,{icon:"chat",label:"Conversations",onClick:B,class:"cursor-pointer"}),t(P,{label:`${b(s.value.participants)} - ${D(s.value.date)}`},null,8,["label"])]),_:1})]),t(g,{class:"header-card q-mb-lg",flat:""},{default:n(()=>[t(h,{class:"q-pa-lg"},{default:n(()=>[o("div",fe,[o("div",ye,[t(L,{size:"64px",color:C(s.value.type),"text-color":"white"},{default:n(()=>[t(u,{name:k(s.value.type),size:"32px"},null,8,["name"])]),_:1},8,["color"])]),o("div",ge,[o("div",he,[o("div",xe,i(b(s.value.participants)),1),t(F,{color:C(s.value.type),"text-color":"white",icon:k(s.value.type)},{default:n(()=>[p(i(z(s.value.type)),1)]),_:1},8,["color","icon"]),s.value.private?(c(),N(F,{key:0,color:"orange","text-color":"white",icon:"lock"},{default:n(()=>[...e[7]||(e[7]=[p(" Private ",-1)])]),_:1})):x("",!0)]),o("div",we,[p(i(D(s.value.date))+" ",1),s.value.location?(c(),d("span",be," â€¢ "+i(s.value.location),1)):x("",!0)]),o("div",qe,[t(u,{name:"schedule",size:"16px",class:"q-mr-xs"}),p(" Added "+i(I(s.value.created_at))+" ",1),s.value.created_by_username?(c(),d("span",ke," by "+i(s.value.created_by_username),1)):x("",!0)])]),o("div",Ce,[o("div",De,[t(m,{outline:"",color:"primary",icon:"edit",label:"Edit",class:"q-mr-sm",onClick:A}),t(m,{outline:"",color:"positive",icon:"add_comment",label:"Follow-up",class:"q-mr-sm",onClick:M}),t(m,{outline:"",color:"negative",icon:"delete",label:"Delete",onClick:e[2]||(e[2]=l=>f.value=!0)})])])])]),_:1})]),_:1}),o("div",Qe,[o("div",$e,[t(g,{class:"content-card q-mb-lg",flat:"",bordered:""},{default:n(()=>[t(h,{class:"q-pa-lg"},{default:n(()=>[e[8]||(e[8]=o("div",{class:"text-h6 q-mb-md text-weight-medium"},"Details",-1)),o("div",Le,[o("div",Te,[t(u,{name:k(s.value.type),size:"20px",color:C(s.value.type)},null,8,["name","color"]),o("div",Ve,[o("div",ze,i(z(s.value.type)),1)])])]),o("div",Be,[o("div",Se,[t(u,{name:"event",size:"20px",color:"grey-7"}),o("div",Ne,[o("div",Pe,i(D(s.value.date)),1)])])]),s.value.location?(c(),d("div",Fe,[o("div",Ie,[t(u,{name:"place",size:"20px",color:"grey-7"}),o("div",Ae,[o("div",Me,i(s.value.location),1)])])])):x("",!0),o("div",Ee,[o("div",Ue,[t(u,{name:s.value.private?"lock":"public",size:"20px",color:s.value.private?"orange":"positive"},null,8,["name","color"]),o("div",je,[o("div",He,i(s.value.private?"Private":"Shared"),1)])])])]),_:1})]),_:1}),t(g,{class:"content-card",flat:"",bordered:""},{default:n(()=>[t(h,{class:"q-pa-lg"},{default:n(()=>[e[9]||(e[9]=o("div",{class:"text-h6 q-mb-md text-weight-medium"},"Participants",-1)),(c(!0),d(G,null,W(s.value.participants,l=>(c(),d("div",{key:l.id,class:"participant-item"},[o("div",{class:"row items-center q-gutter-sm cursor-pointer",onClick:q=>E(l)},[t(L,{size:"32px",color:"grey-4","text-color":"grey-8"},{default:n(()=>[t(u,{name:"person"})]),_:1}),o("div",Ye,[o("div",Je,i(l.name),1),l.name_ext?(c(),d("div",Ke,i(l.name_ext),1)):x("",!0)]),t(u,{name:"chevron_right",color:"grey-5"})],8,Re)]))),128))]),_:1})]),_:1})]),o("div",Oe,[t(g,{class:"content-card",flat:"",bordered:""},{default:n(()=>[t(h,{class:"q-pa-lg"},{default:n(()=>[e[10]||(e[10]=o("div",{class:"text-h6 q-mb-md text-weight-medium"},"Notes",-1)),o("div",Ge,i(s.value.notes),1)]),_:1})]),_:1})])])])):(c(),d("div",ve,[t(u,{name:"chat_bubble_outline",size:"80px",color:"grey-5"}),e[6]||(e[6]=o("div",{class:"text-h6 text-grey-7 q-mt-md"}," Conversation not found ",-1)),t(m,{color:"primary",label:"Back to Conversations",class:"q-mt-md",onClick:B})])),t(X,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l)},{default:n(()=>[t(g,null,{default:n(()=>[t(h,{class:"row items-center"},{default:n(()=>[t(L,{icon:"warning",color:"negative","text-color":"white"}),o("span",We,[e[11]||(e[11]=p(" Are you sure you want to delete this conversation with ",-1)),o("strong",null,i(s.value?b(s.value.participants):""),1),e[12]||(e[12]=p("? This action cannot be undone. ",-1))])]),_:1}),t(Z,{align:"right"},{default:n(()=>[t(m,{flat:"",label:"Cancel",color:"primary",onClick:e[3]||(e[3]=l=>f.value=!1)}),t(m,{flat:"",label:"Delete",color:"negative",onClick:U})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},it=H(Xe,[["__scopeId","data-v-982a5806"]]);export{it as default};
